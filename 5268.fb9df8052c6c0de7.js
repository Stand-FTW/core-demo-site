"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5268],{85268:(ct,Ce,a)=>{a.r(Ce),a.d(Ce,{AdministracaoEmpreendimentosPageModule:()=>ye});var c=a(70655),d=a(98274),x=a(36895),l=a(24006),m=a(48058),Le=a(92216),Ie=a(39528);let _=class{constructor(){this.currentTab="projetos"}ngOnInit(){}changeTab(e){this.currentTab=e.detail.value}};_.ctorParameters=()=>[],_=(0,c.gn)([(0,d.wA2)({selector:"app-administracao-empreendimentos",template:'<ion-header [translucent]="true">\n  <ion-toolbar>\n    <ion-buttons slot="start">\n      <ion-menu-button></ion-menu-button>\n    </ion-buttons>\n    <ion-title>ADM. Empreendimentos</ion-title>\n  </ion-toolbar>\n</ion-header>\n\n<ion-content appScrollTheme>\n  <br />\n  <ion-segment class="background-segment" [(ngModel)]="currentTab" [ngModelOptions]="{standalone: true}"\n    (ionChange)="changeTab($event)">\n    <ion-segment-button style="margin-left: 5px; max-width: 200px" layout="icon-start" value="projetos">\n      <ion-icon style="font-size: 1.2em" name="globe-outline"></ion-icon>\n      <ion-label text-wrap class="wrap-text" style="font-size: 1.1em">\n        Projetos\n      </ion-label>\n    </ion-segment-button>\n  </ion-segment>\n\n\n  <div class="mt-3 wall-background h-screen">\n    <ng-container *ngIf="currentTab === \'projetos\'">\n      <div style="max-width: 95%; margin: auto">\n        <app-projeto-main></app-projeto-main>\n      </div>\n    </ng-container>\n  </div>\n\n</ion-content>',styles:[""]})],_);const Fe=[{path:"",component:_}];let ae=class{};ae=(0,c.gn)([(0,d.LVF)({imports:[Ie.Bz.forChild(Fe)],exports:[Ie.Bz]})],ae);var S=a(85226),re=a(77604),ne=a(9764),j=a(51740),D=a(35593),k=a(82210),ie=a(58783),le=a(63054),L=a(92665),Pe=a(1236),de=a(1997),we=a(23520),De=a(17913),ce=a(38433),pe=a(50613),Te=a(61989),me=a(21493),Oe=a(25047),z=a(32137),Ee=a(3631),ue=a(79512),T=a(91795),Ne=a(70585),$=a(45132),F=a(15108),ve=a(68271),V=a(21327),W=a(32506),Z=a(42480),Ae=a(73814),u=a(15861);var X=a(50727),O=a(59256),Ue=a(95494),Re=a(55575),Be=a(94826),i=a(98739),v=a(59136),h=a(48090),fe=a(34758),he=a(81695),b=a(52710),E=a(75871);let N=class{constructor(e,t,o,s,r,n){this.formBuilder=e,this.projetosService=t,this.modalCadastro=o,this.toastService=s,this.empresasService=r,this.userService=n,this.wasCreated=!1,this.isCliente=!1,this.maxDate=Ue.E.getDiaAnterior(),this.currentEmpresasPage=1,this.searchedEmpresa="",this.currentUserPage=1,this.searchedUser="",this.ProjetoStatusSelect=h.sB,this.ProjetoTipoSelect=h.UP,this.ProjetoCategoriaSelect=h.eI,this.ProjetoPrioridadeSelect=h.w$,this.subscriptions=new X.w0}ngOnInit(){this.form=this.formBuilder.group({nome:[,[l.kI.required]],descricao:[,[l.kI.required]],observacao:[,[]],beneficio:[,[]],risco:[,[]],status:[,[]],tipo:[,[l.kI.required]],categoria:[,[l.kI.required]],prioridade:[,[l.kI.required]],custo_projeto:[,[]],valor_cobrado:[,[]],data_inicio_previsto:[,[]],data_fim_previsto:[,[]],data_inicio_real:[,[]],data_fim_real:[,[]],empresa_detentora_id:[,[]],responsavel_id:[,[]]}),this.loadEmpresas(),this.loadUsers()}ngOnDestroy(){this.subscriptions.unsubscribe()}create(){const e=this.form.get("nome").value,t=this.form.get("custo_projeto").value,o=this.form.get("valor_cobrado").value,s=this.form.get("descricao").value,r=this.form.get("observacao").value,n=this.form.get("beneficio").value,f=this.form.get("risco").value,g=this.form.get("tipo").value,y=this.form.get("status").value,G=this.form.get("categoria").value,J=this.form.get("prioridade").value,U=this.form.get("data_inicio_previsto").value,R=this.form.get("data_fim_previsto").value,B=this.form.get("data_inicio_real").value,M=this.form.get("data_fim_real").value,K=this.form.get("empresa_detentora_id").value,H=this.form.get("responsavel_id").value,Se=this.projetosService.create({nome:e,observacao:r,beneficio:n,risco:f,categoria:G,prioridade:J,data_inicio_real:B,descricao:s,tipo:g,status:y,custo_projeto:t,data_fim_previsto:R,data_fim_real:M,data_inicio_previsto:U,empresa_detentora_id:K,responsavel_id:H,valor_cobrado:o}).subscribe(dt=>{this.wasCreated=!0,this.fechar()});this.subscriptions.add(Se)}loadEmpresas(e=1){const t=this.empresasService.list({searchedEmpresa:this.searchedEmpresa},{order:v.L.ASC,page:e,take:10}).subscribe(o=>{this.empresas=o});this.subscriptions.add(t)}searchEmpresa({value:e}){this.searchedEmpresa=e,this.loadEmpresas(1)}clearEmpresa(e){e.value="",this.searchedEmpresa="",this.loadEmpresas(1)}paginarEmpresas(e){const{first:t,rows:o}=e,s=Number(Number(t)/Number(o)+1);s!=this.currentEmpresasPage&&(this.currentEmpresasPage=s,this.loadEmpresas(s))}detailEmpresa(){const e=this.form.get("empresa_detentora_id").value,t=this.empresas.data.find(o=>o.id==e);t?this.showModal(Be.P,{empresa:t}):this.toastService.presentToast({detalhe:"Selecione uma empresa primeiro",titulo:"N\xe3o informado",duracao:i.m4.shortDuration,gravidade:i.kl.INFORMACAO})}loadUsers(e=1){const t=this.userService.listUsers({searchedUser:this.searchedUser,tipos_usarios:`${b.Wo.COLABORADOR}, ${b.Wo.PRESTADOR}`},{order:v.L.ASC,page:e,take:10}).subscribe(o=>{this.users=o});this.subscriptions.add(t)}searchUser({value:e}){this.searchedUser=e,this.loadUsers(1)}clearUser(e){e.value="",this.searchedUser="",this.loadUsers(1)}paginarUsers(e){const{first:t,rows:o}=e,s=Number(Number(t)/Number(o)+1);s!=this.currentUserPage&&(this.currentUserPage=s,this.loadUsers(s))}detailUser(){const e=this.form.get("responsavel_id").value,t=this.users.data.find(o=>o.id==e);t?this.showModal(he.Q,{user:t}):this.toastService.presentToast({detalhe:"Selecione um usu\xe1rio primeiro",titulo:"N\xe3o informado",duracao:i.m4.shortDuration,gravidade:i.kl.INFORMACAO})}fechar(){this.modalCadastro.dismiss(this.wasCreated)}isInputError(e){return!(this.form.controls[e].untouched||!this.form.controls[e].errors)}disableCreateBtn(){return!this.form.valid}showModal(e,t){var o=this;return(0,u.Z)(function*(){const s=yield o.modalCadastro.create({component:e,backdropDismiss:!1,cssClass:"modal-size-100",componentProps:t});return s.onDidDismiss().then(r=>{}),yield s.present()})()}};N.ctorParameters=()=>[{type:l.QS},{type:E.T},{type:m.IN},{type:O.D},{type:Re.o},{type:fe.K}],N=(0,c.gn)([(0,d.wA2)({selector:"app-projeto-cadastro",template:'<ion-content appScrollTheme>\n  <form [formGroup]="form" (ngSubmit)="$event.preventDefault()">\n    <div class="surface-ground px-4 py-8 md:px-6 lg:px-8">\n      <div class="text-900 font-medium text-xl mb-1">Criar/Cadastrar</div>\n      <div class="surface-card p-4 shadow-2 border-round p-fluid">\n        <div class="grid formgrid p-fluid">\n\n          <div class="field mb-4 col-12">\n            <label for="nome" class="font-medium text-900">Nome</label>\n            <input id="nome" placeholder="Nome" type="text" pInputText formControlName="nome">\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'nome\')"></p-message>\n            </div>\n          </div>\n\n          <div class="field mb-4 col-12 md:col-6">\n            <label for="custo_projeto" class="font-medium text-900">Custo</label>\n            <p-inputNumber id="custo_projeto" formControlName="custo_projeto" mode="decimal" [minFractionDigits]="2"\n              [maxFractionDigits]="2"></p-inputNumber>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'custo_projeto\')"></p-message>\n            </div>\n          </div>\n          <div class="field mb-4 col-12 md:col-6">\n            <label for="valor_cobrado" class="font-medium text-900">Valor a ser cobrado</label>\n            <p-inputNumber id="valor_cobrado" formControlName="valor_cobrado" mode="decimal" [minFractionDigits]="2"\n              [maxFractionDigits]="2"></p-inputNumber>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'valor_cobrado\')"></p-message>\n            </div>\n          </div>\n\n          <div *ngIf="empresas" class="col-12 field ">\n            <label for="empresa_detentora_id" class="text-900 font-medium mb-3">Empresa</label>\n            <div class="ml-3 cursor-pointer pi pi-question-circle" (click)="detailEmpresa()"></div>\n            <p-dropdown id="empresa_detentora_id" [options]="empresas.data" [filter]="true" placeholder="Selecione"\n              [virtualScroll]="true" [virtualScrollItemSize]="38" [lazy]="true" formControlName="empresa_detentora_id"\n              optionLabel="razao_social" optionValue="id" filterBy="razao_social, cnpj" [showClear]="true">\n              <ng-template pTemplate="filter" let-options="options">\n                <div class="flex p-3">\n                  <div class="p-inputgroup" (click)="$event.stopPropagation()">\n                    <input #searchEmpresaInput type="text" pInputText placeholder="Procurar"\n                      (keyup.enter)="searchempresa(searchEmpresaInput)">\n                    <button pButton pRipple icon="pi pi-search" (click)="searchEmpresa(searchEmpresaInput)"></button>\n                    <button class="p-button-outlined" pButton pRipple icon="pi pi-times"\n                      (click)="clearEmpresa(searchEmpresaInput)"></button>\n                  </div>\n                </div>\n              </ng-template>\n              <ng-template pTemplate="loader" let-options="options">\n                <div class="flex align-items-center py-2 px-3" style="height: 38px">\n                  <p-skeleton width="50%" height="1rem"></p-skeleton>\n                </div>\n              </ng-template>\n              <ng-template let-empresa pTemplate="item">\n                <div>\n                  <div>{{ empresa.razao_social}} - {{ empresa.cnpj | cnpjMask}}</div>\n                </div>\n              </ng-template>\n              <ng-template let-empresa pTemplate="selectedItem">\n                <div>{{ empresa.razao_social}} - {{ empresa.cnpj | cnpjMask}}</div>\n              </ng-template>\n            </p-dropdown>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'empresa_detentora_id\')"></p-message>\n            </div>\n          </div>\n          <div *ngIf="users" class="col-12 field ">\n            <label for="responsavel_id" class="text-900 font-medium mb-3">Respons\xe1vel</label>\n            <div class="ml-3 cursor-pointer pi pi-question-circle" (click)="detailUser()"></div>\n            <p-dropdown id="responsavel_id" [options]="users.data" [filter]="true" placeholder="Selecione"\n              [virtualScroll]="true" [virtualScrollItemSize]="38" [lazy]="true" formControlName="responsavel_id"\n              optionLabel="nome" optionValue="id" filterBy="nome, cpf" [showClear]="true">\n              <ng-template pTemplate="filter" let-options="options">\n                <div class="flex p-3">\n                  <div class="p-inputgroup" (click)="$event.stopPropagation()">\n                    <input #searchUserInput type="text" pInputText placeholder="Procurar"\n                      (keyup.enter)="searchUser(searchUserInput)">\n                    <button pButton pRipple icon="pi pi-search" (click)="searchUser(searchUserInput)"></button>\n                    <button class="p-button-outlined" pButton pRipple icon="pi pi-times"\n                      (click)="clearUser(searchUserInput)"></button>\n                  </div>\n                </div>\n              </ng-template>\n              <ng-template pTemplate="loader" let-options="options">\n                <div class="flex align-items-center py-2 px-3" style="height: 38px">\n                  <p-skeleton width="50%" height="1rem"></p-skeleton>\n                </div>\n              </ng-template>\n              <ng-template let-user pTemplate="item">\n                <div>\n                  <div>{{ user.nome}} - {{ user.cpf | cpfMask}}</div>\n                </div>\n              </ng-template>\n              <ng-template let-user pTemplate="selectedItem">\n                <div>{{ user.nome}} - {{ user.cpf | cpfMask}}</div>\n              </ng-template>\n            </p-dropdown>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'responsavel_id\')"></p-message>\n            </div>\n          </div>\n          <div class="surface-border border-top-1 opacity-50 mb-4 col-12"></div>\n\n          <div class="field mb-4 col-12 ">\n            <label for="descricao" class="font-medium text-900">Descri\xe7\xe3o</label>\n            <textarea class="h-auto" id="descricao" pInputTextarea [autoResize]="true" [rows]="5"\n              formControlName="descricao"></textarea>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'descricao\')"></p-message>\n            </div>\n          </div>\n          <div class="field mb-4 col-12 ">\n            <label for="observacao" class="font-medium text-900">Observa\xe7\xe3o</label>\n            <textarea class="h-auto" id="observacao" pInputTextarea [autoResize]="true" [rows]="5"\n              formControlName="observacao"></textarea>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'observacao\')"></p-message>\n            </div>\n          </div>\n          <div class="field mb-4 col-12 ">\n            <label for="beneficio" class="font-medium text-900">Benef\xedcio</label>\n            <textarea class="h-auto" id="beneficio" pInputTextarea [autoResize]="true" [rows]="5"\n              formControlName="beneficio"></textarea>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'beneficio\')"></p-message>\n            </div>\n          </div>\n          <div class="field mb-4 col-12 ">\n            <label for="risco" class="font-medium text-900">Risco</label>\n            <textarea class="h-auto" id="risco" pInputTextarea [autoResize]="true" [rows]="5"\n              formControlName="risco"></textarea>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'risco\')"></p-message>\n            </div>\n          </div>\n          <div class="surface-border border-top-1 opacity-50 mb-4 col-12"></div>\n\n          <div class="field mb-4 col-12 md:col-6">\n            <label for="tipo">Tipo de Projeto</label>\n            <p-dropdown [options]="ProjetoTipoSelect" placeholder="Tipo de Projeto" formControlName="tipo"></p-dropdown>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'tipo\')"></p-message>\n            </div>\n          </div>\n          <div class="field mb-4 col-12 md:col-6">\n            <label for="categoria">Categoria</label>\n            <p-dropdown [options]="ProjetoCategoriaSelect" placeholder="Categoria do Projeto"\n              formControlName="categoria"></p-dropdown>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'categoria\')"></p-message>\n            </div>\n          </div>\n\n          <div class="field mb-4 col-12 md:col-6">\n            <label for="status">Situa\xe7\xe3o</label>\n            <p-dropdown [options]="ProjetoStatusSelect" placeholder="Situa\xe7\xe3o do Projeto" formControlName="status"\n              [showClear]="true"></p-dropdown>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'status\')"></p-message>\n            </div>\n          </div>\n          <div class="field mb-4 col-12 md:col-6">\n            <label for="prioridade">Prioridade</label>\n            <p-dropdown [options]="ProjetoPrioridadeSelect" placeholder="Recorr\xeancia de Pagamento"\n              formControlName="prioridade"></p-dropdown>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'prioridade\')"></p-message>\n            </div>\n          </div>\n          <div class="surface-border border-top-1 opacity-50 mb-4 col-12"></div>\n\n          <div class="field mb-4 col-12 md:col-6">\n            <label for="data_inicio_previsto" class="font-medium text-900">Data de in\xedcio (previsto)</label>\n            <p-calendar id="data_inicio_previsto" [showIcon]="true" formControlName="data_inicio_previsto">\n            </p-calendar>\n          </div>\n          <div class="field mb-4 col-12 md:col-6">\n            <label for="data_fim_previsto" class="font-medium text-900">Data de fim (previsto)</label>\n            <p-calendar id="data_fim_previsto" [showIcon]="true" formControlName="data_fim_previsto">\n            </p-calendar>\n          </div>\n          <div class="field mb-4 col-12 md:col-6">\n            <label for="data_inicio_real" class="font-medium text-900">Data de in\xedcio (real)</label>\n            <p-calendar id="data_inicio_real" [showIcon]="true" formControlName="data_inicio_real">\n            </p-calendar>\n          </div>\n          <div class="field mb-4 col-12 md:col-6">\n            <label for="data_fim_real" class="font-medium text-900">Data de fim (real)</label>\n            <p-calendar id="data_fim_real" [showIcon]="true" formControlName="data_fim_real">\n            </p-calendar>\n          </div>\n\n          <div class="surface-border border-top-1 opacity-50 mb-4 col-12"></div>\n        </div>\n        <div class="flex justify-content-end">\n          <button pButton pRipple label="Cadastrar" icon="pi pi-send" iconPos="right" class="w-auto" (click)="create()"\n            [disabled]="disableCreateBtn()"></button>\n        </div>\n      </div>\n    </div>\n  </form>\n\n</ion-content>\n\n<ion-footer>\n  <ion-toolbar>\n    <ion-button expand="full" color="danger" (click)="fechar()">Fechar</ion-button>\n  </ion-toolbar>\n</ion-footer>',styles:[""]})],N);var be=a(69768);let Y=class{};Y=(0,c.gn)([(0,d.LVF)({declarations:[N],imports:[x.ez,l.u5,l.UX,m.Pc,re.FI,ue.QK,j.j,we.zz,De.Iu,le.A,Te.nD,T.T,Oe.L$,Ee.WN,$.l,F.x,ve.F,V.$9,de.U,pe.cc,ne.Q,Ne._8,ce.ON,k.kW,Pe.q,ie.LU,j.j,me.S,D.hJ,L.O,z.D,S.o,W.X,Z.R,Ae.b,be.B],exports:[N]})],Y);let C=class{constructor(e,t,o,s,r,n){this.formBuilder=e,this.projetosService=t,this.modalCadastro=o,this.toastService=s,this.empresasService=r,this.userService=n,this.wasCreated=!1,this.isCliente=!1,this.maxDate=Ue.E.getDiaAnterior(),this.currentEmpresasPage=1,this.searchedEmpresa="",this.currentUserPage=1,this.searchedUser="",this.ProjetoStatusSelect=h.sB,this.ProjetoTipoSelect=h.UP,this.ProjetoCategoriaSelect=h.eI,this.ProjetoPrioridadeSelect=h.w$,this.subscriptions=new X.w0}ngOnInit(){const{nome:e,descricao:t,observacao:o,beneficio:s,risco:r,status:n,tipo:f,categoria:g,prioridade:y,custo_projeto:G,valor_cobrado:J,data_fim_previsto:U,data_fim_real:R,data_inicio_previsto:B,data_inicio_real:M,responsavel:K,empresa_detentora:H}=this.projeto;this.form=this.formBuilder.group({nome:[e,[l.kI.required]],descricao:[t,[l.kI.required]],observacao:[o,[]],beneficio:[s,[]],risco:[r,[]],status:[n,[]],tipo:[f,[l.kI.required]],categoria:[g,[l.kI.required]],prioridade:[y,[l.kI.required]],custo_projeto:[G,[]],valor_cobrado:[J,[]],data_inicio_previsto:[B?new Date(B):void 0,[]],data_fim_previsto:[U?new Date(U):void 0,[]],data_inicio_real:[M?new Date(M):void 0,[]],data_fim_real:[R?new Date(R):void 0,[]],empresa_detentora_id:[H?.id||void 0,[]],responsavel_id:[K?.id||void 0,[]]}),this.loadEmpresas(),this.loadUsers()}ngOnDestroy(){this.subscriptions.unsubscribe()}update(){const e=this.form.get("nome").value;let t=this.form.get("custo_projeto").value;t=t?Number(t):void 0;let o=this.form.get("valor_cobrado").value;o=o?Number(o):void 0;const s=this.form.get("descricao").value,r=this.form.get("observacao").value,n=this.form.get("beneficio").value,f=this.form.get("risco").value,g=this.form.get("tipo").value,y=this.form.get("status").value,G=this.form.get("categoria").value,J=this.form.get("prioridade").value,U=this.form.get("data_inicio_previsto").value,R=this.form.get("data_fim_previsto").value,B=this.form.get("data_inicio_real").value,M=this.form.get("data_fim_real").value,K=this.form.get("empresa_detentora_id").value,H=this.form.get("responsavel_id").value,Se=this.projetosService.update({nome:e,observacao:r,beneficio:n,risco:f,categoria:G,prioridade:J,data_inicio_real:B,descricao:s,tipo:g,status:y,custo_projeto:t,data_fim_previsto:R,data_fim_real:M,data_inicio_previsto:U,empresa_detentora_id:K,responsavel_id:H,valor_cobrado:o},this.projeto.id).subscribe(dt=>{this.wasCreated=!0,this.fechar()});this.subscriptions.add(Se)}loadEmpresas(e=1){const t=this.empresasService.list({searchedEmpresa:this.searchedEmpresa},{order:v.L.ASC,page:e,take:10}).subscribe(o=>{this.empresas=o});this.subscriptions.add(t)}searchEmpresa({value:e}){this.searchedEmpresa=e,this.loadEmpresas(1)}clearEmpresa(e){e.value="",this.searchedEmpresa="",this.loadEmpresas(1)}paginarEmpresas(e){const{first:t,rows:o}=e,s=Number(Number(t)/Number(o)+1);s!=this.currentEmpresasPage&&(this.currentEmpresasPage=s,this.loadEmpresas(s))}detailEmpresa(){const e=this.form.get("empresa_detentora_id").value,t=this.empresas.data.find(o=>o.id==e);t?this.showModal(Be.P,{empresa:t}):this.toastService.presentToast({detalhe:"Selecione uma empresa primeiro",titulo:"N\xe3o informado",duracao:i.m4.shortDuration,gravidade:i.kl.INFORMACAO})}loadUsers(e=1){const t=this.userService.listUsers({searchedUser:this.searchedUser,tipos_usarios:`${b.Wo.COLABORADOR}, ${b.Wo.PRESTADOR}`},{order:v.L.ASC,page:e,take:10}).subscribe(o=>{o.data=class Qe{static addCurrentObjectToArray(e,t,o){return!t||!o||e.find(r=>r[o]==t[r])||e.push(t),e}}.addCurrentObjectToArray(o.data,this.projeto.responsavel,"id"),this.users=o,console.log(this.users)});this.subscriptions.add(t)}searchUser({value:e}){this.searchedUser=e,this.loadUsers(1)}clearUser(e){e.value="",this.searchedUser="",this.loadUsers(1)}paginarUsers(e){const{first:t,rows:o}=e,s=Number(Number(t)/Number(o)+1);s!=this.currentUserPage&&(this.currentUserPage=s,this.loadUsers(s))}detailUser(){const e=this.form.get("responsavel_id").value,t=this.users.data.find(o=>o.id==e);t?this.showModal(he.Q,{user:t}):this.toastService.presentToast({detalhe:"Selecione um usu\xe1rio primeiro",titulo:"N\xe3o informado",duracao:i.m4.shortDuration,gravidade:i.kl.INFORMACAO})}fechar(){this.modalCadastro.dismiss(this.wasCreated)}isInputError(e){return!(this.form.controls[e].untouched||!this.form.controls[e].errors)}disableCreateBtn(){return!this.form.valid}showModal(e,t){var o=this;return(0,u.Z)(function*(){const s=yield o.modalCadastro.create({component:e,backdropDismiss:!1,cssClass:"modal-size-100",componentProps:t});return s.onDidDismiss().then(r=>{}),yield s.present()})()}};C.ctorParameters=()=>[{type:l.QS},{type:E.T},{type:m.IN},{type:O.D},{type:Re.o},{type:fe.K}],C.propDecorators={projeto:[{type:d.IIB}]},C=(0,c.gn)([(0,d.wA2)({selector:"app-projeto-detail",template:'<ion-content appScrollTheme>\n  <form [formGroup]="form" (ngSubmit)="$event.preventDefault()">\n    <div class="surface-ground px-4 py-8 md:px-6 lg:px-8">\n      <div class="text-900 font-medium text-xl mb-1">Atualizar</div>\n      <div class="surface-card p-4 shadow-2 border-round p-fluid">\n        <div class="grid formgrid p-fluid">\n\n          <div class="field mb-4 col-12">\n            <label for="nome" class="font-medium text-900">Nome</label>\n            <input id="nome" placeholder="Nome" type="text" pInputText formControlName="nome">\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'nome\')"></p-message>\n            </div>\n          </div>\n\n          <div class="field mb-4 col-12 md:col-6">\n            <label for="custo_projeto" class="font-medium text-900">Custo</label>\n            <p-inputNumber id="custo_projeto" formControlName="custo_projeto" mode="decimal" [minFractionDigits]="2"\n              [maxFractionDigits]="2"></p-inputNumber>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'custo_projeto\')"></p-message>\n            </div>\n          </div>\n          <div class="field mb-4 col-12 md:col-6">\n            <label for="valor_cobrado" class="font-medium text-900">Valor a ser cobrado</label>\n            <p-inputNumber id="valor_cobrado" formControlName="valor_cobrado" mode="decimal" [minFractionDigits]="2"\n              [maxFractionDigits]="2"></p-inputNumber>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'valor_cobrado\')"></p-message>\n            </div>\n          </div>\n\n          <div *ngIf="empresas" class="col-12 field ">\n            <label for="empresa_detentora_id" class="text-900 font-medium mb-3">Empresa</label>\n            <div class="ml-3 cursor-pointer pi pi-question-circle" (click)="detailEmpresa()"></div>\n            <p-dropdown id="empresa_detentora_id" [options]="empresas.data" [filter]="true" placeholder="Selecione"\n              [virtualScroll]="true" [virtualScrollItemSize]="38" [lazy]="true" formControlName="empresa_detentora_id"\n              optionLabel="razao_social" optionValue="id" filterBy="razao_social, cnpj" [showClear]="true">\n              <ng-template pTemplate="filter" let-options="options">\n                <div class="flex p-3">\n                  <div class="p-inputgroup" (click)="$event.stopPropagation()">\n                    <input #searchEmpresaInput type="text" pInputText placeholder="Procurar"\n                      (keyup.enter)="searchempresa(searchEmpresaInput)">\n                    <button pButton pRipple icon="pi pi-search" (click)="searchEmpresa(searchEmpresaInput)"></button>\n                    <button class="p-button-outlined" pButton pRipple icon="pi pi-times"\n                      (click)="clearEmpresa(searchEmpresaInput)"></button>\n                  </div>\n                </div>\n              </ng-template>\n              <ng-template pTemplate="loader" let-options="options">\n                <div class="flex align-items-center py-2 px-3" style="height: 38px">\n                  <p-skeleton width="50%" height="1rem"></p-skeleton>\n                </div>\n              </ng-template>\n              <ng-template let-empresa pTemplate="item">\n                <div>\n                  <div>{{ empresa.razao_social}} - {{ empresa.cnpj | cnpjMask}}</div>\n                </div>\n              </ng-template>\n              <ng-template let-empresa pTemplate="selectedItem">\n                <div>{{ empresa.razao_social}} - {{ empresa.cnpj | cnpjMask}}</div>\n              </ng-template>\n            </p-dropdown>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'empresa_detentora_id\')"></p-message>\n            </div>\n          </div>\n          <div *ngIf="users" class="col-12 field ">\n            <label for="responsavel_id" class="text-900 font-medium mb-3">Respons\xe1vel</label>\n            <div class="ml-3 cursor-pointer pi pi-question-circle" (click)="detailUser()"></div>\n            <p-dropdown id="responsavel_id" [options]="users.data" [filter]="true" placeholder="Selecione"\n              [virtualScroll]="true" [virtualScrollItemSize]="38" [lazy]="true" formControlName="responsavel_id"\n              optionLabel="nome" optionValue="id" filterBy="nome, cpf" [showClear]="true">\n              <ng-template pTemplate="filter" let-options="options">\n                <div class="flex p-3">\n                  <div class="p-inputgroup" (click)="$event.stopPropagation()">\n                    <input #searchUserInput type="text" pInputText placeholder="Procurar"\n                      (keyup.enter)="searchUser(searchUserInput)">\n                    <button pButton pRipple icon="pi pi-search" (click)="searchUser(searchUserInput)"></button>\n                    <button class="p-button-outlined" pButton pRipple icon="pi pi-times"\n                      (click)="clearUser(searchUserInput)"></button>\n                  </div>\n                </div>\n              </ng-template>\n              <ng-template pTemplate="loader" let-options="options">\n                <div class="flex align-items-center py-2 px-3" style="height: 38px">\n                  <p-skeleton width="50%" height="1rem"></p-skeleton>\n                </div>\n              </ng-template>\n              <ng-template let-user pTemplate="item">\n                <div>\n                  <div>{{ user.nome}} - {{ user.cpf | cpfMask}}</div>\n                </div>\n              </ng-template>\n              <ng-template let-user pTemplate="selectedItem">\n                <div>{{ user.nome}} - {{ user.cpf | cpfMask}}</div>\n              </ng-template>\n            </p-dropdown>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'responsavel_id\')"></p-message>\n            </div>\n          </div>\n          <div class="surface-border border-top-1 opacity-50 mb-4 col-12"></div>\n\n          <div class="field mb-4 col-12 ">\n            <label for="descricao" class="font-medium text-900">Descri\xe7\xe3o</label>\n            <textarea class="h-auto" id="descricao" pInputTextarea [autoResize]="true" [rows]="5"\n              formControlName="descricao"></textarea>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'descricao\')"></p-message>\n            </div>\n          </div>\n          <div class="field mb-4 col-12 ">\n            <label for="observacao" class="font-medium text-900">Observa\xe7\xe3o</label>\n            <textarea class="h-auto" id="observacao" pInputTextarea [autoResize]="true" [rows]="5"\n              formControlName="observacao"></textarea>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'observacao\')"></p-message>\n            </div>\n          </div>\n          <div class="field mb-4 col-12 ">\n            <label for="beneficio" class="font-medium text-900">Benef\xedcio</label>\n            <textarea class="h-auto" id="beneficio" pInputTextarea [autoResize]="true" [rows]="5"\n              formControlName="beneficio"></textarea>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'beneficio\')"></p-message>\n            </div>\n          </div>\n          <div class="field mb-4 col-12 ">\n            <label for="risco" class="font-medium text-900">Risco</label>\n            <textarea class="h-auto" id="risco" pInputTextarea [autoResize]="true" [rows]="5"\n              formControlName="risco"></textarea>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'risco\')"></p-message>\n            </div>\n          </div>\n          <div class="surface-border border-top-1 opacity-50 mb-4 col-12"></div>\n\n          <div class="field mb-4 col-12 md:col-6">\n            <label for="tipo">Tipo de Projeto</label>\n            <p-dropdown [options]="ProjetoTipoSelect" placeholder="Tipo de Projeto" formControlName="tipo"></p-dropdown>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'tipo\')"></p-message>\n            </div>\n          </div>\n          <div class="field mb-4 col-12 md:col-6">\n            <label for="categoria">Categoria</label>\n            <p-dropdown [options]="ProjetoCategoriaSelect" placeholder="Categoria do Projeto"\n              formControlName="categoria"></p-dropdown>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'categoria\')"></p-message>\n            </div>\n          </div>\n\n          <div class="field mb-4 col-12 md:col-6">\n            <label for="status">Situa\xe7\xe3o</label>\n            <p-dropdown [options]="ProjetoStatusSelect" placeholder="Situa\xe7\xe3o do Projeto" formControlName="status"\n              [showClear]="true"></p-dropdown>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'status\')"></p-message>\n            </div>\n          </div>\n          <div class="field mb-4 col-12 md:col-6">\n            <label for="prioridade">Prioridade</label>\n            <p-dropdown [options]="ProjetoPrioridadeSelect" placeholder="Recorr\xeancia de Pagamento"\n              formControlName="prioridade"></p-dropdown>\n            <div class="flex mt-1 justify-content-end">\n              <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'prioridade\')"></p-message>\n            </div>\n          </div>\n          <div class="surface-border border-top-1 opacity-50 mb-4 col-12"></div>\n\n          <div class="field mb-4 col-12 md:col-6">\n            <label for="data_inicio_previsto" class="font-medium text-900">Data de in\xedcio (previsto)</label>\n            <p-calendar id="data_inicio_previsto" [showIcon]="true" formControlName="data_inicio_previsto">\n            </p-calendar>\n          </div>\n          <div class="field mb-4 col-12 md:col-6">\n            <label for="data_fim_previsto" class="font-medium text-900">Data de fim (previsto)</label>\n            <p-calendar id="data_fim_previsto" [showIcon]="true" formControlName="data_fim_previsto">\n            </p-calendar>\n          </div>\n          <div class="field mb-4 col-12 md:col-6">\n            <label for="data_inicio_real" class="font-medium text-900">Data de in\xedcio (real)</label>\n            <p-calendar id="data_inicio_real" [showIcon]="true" formControlName="data_inicio_real">\n            </p-calendar>\n          </div>\n          <div class="field mb-4 col-12 md:col-6">\n            <label for="data_fim_real" class="font-medium text-900">Data de fim (real)</label>\n            <p-calendar id="data_fim_real" [showIcon]="true" formControlName="data_fim_real">\n            </p-calendar>\n          </div>\n\n          <div class="surface-border border-top-1 opacity-50 mb-4 col-12"></div>\n        </div>\n        <div class="flex justify-content-end">\n          <button pButton pRipple label="Atualizar" icon="pi pi-send" iconPos="right" class="w-auto" (click)="update()"\n            [disabled]="disableCreateBtn()"></button>\n        </div>\n      </div>\n    </div>\n  </form>\n\n</ion-content>\n\n<ion-footer>\n  <ion-toolbar>\n    <ion-button expand="full" color="danger" (click)="fechar()">Fechar</ion-button>\n  </ion-toolbar>\n</ion-footer>',styles:[""]})],C);let q=class{};q=(0,c.gn)([(0,d.LVF)({declarations:[C],imports:[x.ez,l.u5,l.UX,m.Pc,re.FI,ue.QK,j.j,we.zz,De.Iu,le.A,Te.nD,T.T,Oe.L$,Ee.WN,$.l,F.x,ve.F,V.$9,de.U,pe.cc,ne.Q,Ne._8,ce.ON,k.kW,Pe.q,ie.LU,j.j,me.S,D.hJ,L.O,z.D,S.o,W.X,Z.R,Ae.b,be.B],exports:[C]})],q);var Ge=a(2635);var He=a(49808),Ye=a(53583),qe=a(12983),A=a.n(qe),ge=a(5491);let ee=class{constructor(e,t){this.projetosService=e,this.filesService=t}generateReportById(e){var t=this;return(0,u.Z)(function*(){const o=yield(0,He.n)(t.projetosService.findOneToReport(e));let s=new Ye.default("l","mm","a4");s=t.setRosto(o,s),yield t.filesService.savePdfFromJS(s,"teste.pdf",!0)})()}setRosto(e,t){const o={valign:"middle",halign:"center"};let s,r;return s=["ID"],r=[e.id],A()(t,{head:[s],body:[r],didDrawCell:n=>{},styles:o,tableWidth:"auto"}),s=["Nome","Situa\xe7\xe3o"],r=[e.nome,e.status],A()(t,{head:[s],body:[r],didDrawCell:n=>{},styles:o,tableWidth:"auto"}),s=["Solicitante","Situa\xe7\xe3o"],r=[e.nome,e.status],A()(t,{head:[s],body:[r],didDrawCell:n=>{},styles:o,tableWidth:"auto"}),s=["Tipo","Categoria","Prioridade"],r=[e.tipo,e.categoria,e.prioridade],A()(t,{head:[s],body:[r],didDrawCell:n=>{},styles:o,tableWidth:"auto"}),s=["Descri\xe7\xe3o"],r=[e.descricao],A()(t,{head:[s],body:[r],didDrawCell:n=>{},styles:o,tableWidth:"auto"}),s=["Observa\xe7\xe3o"],r=[e.observacao],A()(t,{head:[s],body:[r],didDrawCell:n=>{},styles:o,tableWidth:"auto"}),t}};ee.ctorParameters=()=>[{type:E.T},{type:ge.n}],ee=(0,c.gn)([(0,d.GSi)({providedIn:"root"})],ee);var Me=a(41117);var _e=a(10805),ot=a(890),st=a(31191);let I=class{constructor(e,t){this.modal=e,this.toastMessageService=t,this.hasUpdate=!1}ngOnInit(){this.toastMessageService.clearToast()}fechar(){var e=this;return(0,u.Z)(function*(){yield e.modal.dismiss(e.hasUpdate)})()}};I.ctorParameters=()=>[{type:m.IN},{type:O.D}],I.propDecorators={contrato:[{type:d.IIB}]},I=(0,c.gn)([(0,d.wA2)({selector:"app-contrato-brief",template:'<ion-content appScrollTheme>\n  <div class="surface-card p-4 border-round shadow-2">\n    <div class="col-12">\n      <div class="border-1 border-double border-primary surface-border border-round mt-4" style="min-height: 30rem">\n        <ng-container *ngIf="contrato">\n          <div class="surface-card p-4 shadow-2 border-round">\n            <div class="flex align-items-center justify-content-end ml-auto cursor-pointer"\n              style="position: fixed; top: 15px; right: 15px;" (click)="fechar()">\n              <span\n                class="flex align-items-center justify-content-center bg-pink-100 text-pink-800 border-circle vertical-align-top"\n                style="width: 24px; height: 24px;">\n                <i class="pi pi-times text-sm"></i>\n              </span>\n            </div>\n            <div class="font-medium text-3xl text-900 mb-3">Detalhamento do Contrato</div>\n            <div class="text-primary mb-5">{{ contrato.id }}</div>\n            <ul class="list-none p-0 m-0 border-top-1 surface-border">\n              <li *ngIf="contrato" class="flex align-items-center py-3 px-2 flex-wrap ">\n                <div class="text-900 w-full">\n                  <div class="grid mt-0 mr-0">\n                    <div class="col-12 md:col-6">\n                      <div class="p-3 border-1 surface-border border-round surface-card">\n                        <div class="text-900 mb-2">\n                          <span class="font-medium">Nome</span>\n                        </div>\n                        <div class="text-700">{{ contrato.nome }}</div>\n                      </div>\n                    </div>\n                    <div class="col-12 md:col-6">\n                      <div class="p-3 border-1 surface-border border-round surface-card">\n                        <div class="text-900 mb-2">\n                          <span class="font-medium">C\xf3digo</span>\n                        </div>\n                        <div class="text-700">{{ contrato.codigo_contrato }}</div>\n                      </div>\n                    </div>\n\n                    <div class="col-12 ">\n                      <div class="p-3 border-1 surface-border border-round surface-card">\n                        <div class="text-900 mb-2">\n                          <span class="font-medium">Descri\xe7\xe3o</span>\n                        </div>\n                        <div class="text-700">{{ contrato.descricao }}</div>\n                      </div>\n                    </div>\n                    <div class="col-12 ">\n                      <div class="p-3 border-1 surface-border border-round surface-card">\n                        <div class="text-900 mb-2">\n                          <span class="font-medium">Observa\xe7\xe3o</span>\n                        </div>\n                        <div class="text-700">{{ contrato.observacao || \'N\xe3o informado\' }}</div>\n                      </div>\n                    </div>\n\n                    <div class="col-12 ">\n                      <div class="p-3 border-1 surface-border border-round surface-card">\n                        <div class="text-900 mb-2">\n                          <span class="font-medium">Valor</span>\n                        </div>\n                        <div class="text-700">\n                          {{ contrato.valor ? (contrato.valor | currency:\'BRL\': \'(R$)\') :\n                          \'N\xe3o informado\' }}\n                        </div>\n                      </div>\n                    </div>\n                    <div class="col-12 md:col-6">\n                      <div class="p-3 border-1 surface-border border-round surface-card">\n                        <div class="text-900 mb-2">\n                          <span class="font-medium">Recorr\xeancia de PGTO</span>\n                        </div>\n                        <div class="text-700">{{ contrato.recorrencia_pagamento }}</div>\n                      </div>\n                    </div>\n                    <div class="col-12 md:col-6">\n                      <div class="p-3 border-1 surface-border border-round surface-card">\n                        <div class="text-900 mb-2">\n                          <span class="font-medium">Condi\xe7\xe3o de PGTO</span>\n                        </div>\n                        <div class="text-700">{{ contrato.condicao_pagamento }}</div>\n                      </div>\n                    </div>\n\n                    <div class="col-12 md:col-6">\n                      <div class="p-3 border-1 surface-border border-round surface-card">\n                        <div class="text-900 mb-2">\n                          <span class="font-medium">Situa\xe7\xe3o</span>\n                        </div>\n                        <div class="text-700">{{ contrato.status }}</div>\n                      </div>\n                    </div>\n                    <div class="col-12 md:col-6">\n                      <div class="p-3 border-1 surface-border border-round surface-card">\n                        <div class="text-900 mb-2">\n                          <span class="font-medium">Tipo</span>\n                        </div>\n                        <div class="text-700">{{ contrato.tipo }}</div>\n                      </div>\n                    </div>\n\n                    <div class="col-12 md:col-6">\n                      <div class="p-3 border-1 surface-border border-round surface-card">\n                        <div class="text-900 mb-2">\n                          <span class="font-medium">Data de in\xedcio</span>\n                        </div>\n                        <div class="text-700">{{\n                          contrato.data_inicio ? (contrato.data_inicio | date: \'dd/MM/yyyy\') :\n                          \'N\xe3o informado\'\n                          }}</div>\n                      </div>\n                    </div>\n                    <div class="col-12 md:col-6">\n                      <div class="p-3 border-1 surface-border border-round surface-card">\n                        <div class="text-900 mb-2">\n                          <span class="font-medium">Data de fim</span>\n                        </div>\n                        <div class="text-700">{{\n                          contrato.data_fim ? (contrato.data_fim | date: \'dd/MM/yyyy\') :\n                          \'N\xe3o informado\'\n                          }}</div>\n                      </div>\n                    </div>\n\n                  </div>\n                </div>\n              </li>\n            </ul>\n          </div>\n        </ng-container>\n      </div>\n    </div>\n  </div>\n</ion-content>',styles:[""]})],I);let P=class{constructor(e,t,o,s,r,n,f,g){this.formBuilder=e,this.contratosService=t,this.projetosService=o,this.modalPet=s,this.modalBrief=r,this.toastService=n,this.confirmationService=f,this.filesService=g,this.searchedAssociado=void 0,this.searchedAssociadoTipo=void 0,this.searchedContrato="",this.showProjetoDialog=!1,this.shouldUpdate=!1,this.showDialog=!1,this.currentPage=1,this.pageOrder=v.L.DESC,this.currentTake=5,this.ContratoTipoSelect=st.t1,this.cols=[{field:"id",header:"ID"},{field:"associado.nome",header:"Nome"},{field:"associado.tipo_Projeto",header:"Tipo de usu\xe1rio"}],this.opcoesMenuItens=[{label:"Baixar",items:[{label:"CSV",icon:"pi pi-file-o",command:()=>this.exportCsv()},{label:"XLSX",icon:"pi pi-file-excel",command:()=>this.exportExcel()},{label:"PDF",icon:"pi pi-file-pdf",command:()=>this.exportPdf()}]}],this.subscriptions=new X.w0}ngOnInit(){this.form=this.formBuilder.group({contrato:[,[l.kI.required]]}),this.loadAssociados(),this.loadContratos()}ngOnDestroy(){this.subscriptions.unsubscribe()}loadAssociados(e=1){const t=this.projetosService.findById(this.projeto_id).subscribe({next:o=>{this.projeto=o}});this.subscriptions.add(t)}loadContratos(e=1,t){const o=this.contratosService.list({searchedContrato:this.searchedContrato},{order:v.L.ASC,page:e,take:10}).subscribe(s=>{this.contratos=s,t&&t.show()});this.subscriptions.add(o)}paginar(e,t){t.paginator=!1;const{first:o,rows:s,sortOrder:r}=e,n=Number(Number(o)/Number(s)+1);this.doFilter(e),this.currentPage=n,this.currentTake=s,this.pageOrder=r&&1==r?v.L.DESC:v.L.ASC,this.loadContratos(n)}associar(){const e=this.form.get("contrato").value.id,t=this.projeto.contratos.map(s=>s.id);t.push(e);const o=this.projetosService.updateAssociacaoContratos(this.projeto_id,{contratos:t}).subscribe({next:s=>{this.loadAssociados(),this.toastService.presentToast({titulo:"Sucesso",detalhe:"Opera\xe7\xe3o bem sucedida!",duracao:i.m4.shortDuration,gravidade:i.kl.SUCESSO}),this.form.reset()},error:s=>{}});this.subscriptions.add(o)}desassociar(e){this.confirmationService.confirm({message:`Deseja desassociar "${e.nome}" ?`,header:"Desssocia\xe7\xe3o",icon:"pi pi-exclamation-triangle",accept:()=>{const{contratos:t}=this.projeto,o=t.findIndex(n=>n.id==e.id);t.splice(o,1);const s=t.map(n=>n.id),r=this.projetosService.updateAssociacaoContratos(this.projeto_id,{contratos:s}).subscribe(n=>{this.loadAssociados(),this.toastService.presentToast({titulo:"Sucesso!",detalhe:"Desassociado com sucesso.",duracao:i.m4.shortDuration,gravidade:i.kl.SUCESSO}),this.form.reset()});this.subscriptions.add(r)},reject:t=>{this.toastService.clearToast()}})}fechar(){this.modalPet.dismiss(this.shouldUpdate)}isInputError(e){return!(this.form.controls[e].untouched||!this.form.controls[e].errors)}disableAssociarProjetoBtn(){return!this.form.valid}searchContrato({value:e}){this.searchedContrato=e,this.loadContratos(1)}clearContrato(e){e.value="",this.searchedContrato="",this.loadContratos(1)}detailContrato(e){this.selectedContrato=e||this.form.get("contrato").value,console.log(this.selectedContrato),this.selectedContrato?this.showModal(I,{contrato:this.selectedContrato}):this.toastService.presentToast({detalhe:"Selecione uma op\xe7\xe3o primeiro",titulo:"Sele\xe7\xe3o necess\xe1ria",duracao:i.m4.shortDuration,gravidade:i.kl.INFORMACAO})}doFilter(e){if(!e||!e.filters||!e.filters.tipo)return;const{tipo:t}=e.filters;t[0].value?this.searchedAssociadoTipo=t[0].value:this.searchedAssociadoTipo=void 0}exportPdf(){var e=this;return(0,u.Z)(function*(){const t=`${e.projeto.nome} - ${(new Date).toLocaleDateString()}`,o=e.cols.map(r=>r.header),s=e.convertAssociadoData().map(Object.values);yield e.filesService.exportPdf(t,o,s)})()}exportExcel(){var e=this;return(0,u.Z)(function*(){const t=`${e.projeto.nome} - ${(new Date).toLocaleDateString()}`;yield e.filesService.exportExcel(t,e.convertAssociadoData())})()}exportCsv(){var e=this;return(0,u.Z)(function*(){const t=`${e.projeto.nome} - ${(new Date).toLocaleDateString()}`;yield e.filesService.exportCSV(t,e.convertAssociadoData())})()}convertAssociadoData(){return this.associados.data.map(t=>({id:t.id,nome:t.nome,tipo_projeto:t.tipo}))}showModal(e,t){var o=this;return(0,u.Z)(function*(){const s=yield o.modalBrief.create({component:e,backdropDismiss:!1,cssClass:"modal-size-100",componentProps:t});return s.onDidDismiss().then(r=>{}),yield s.present()})()}};P.ctorParameters=()=>[{type:l.QS},{type:ot.R},{type:E.T},{type:m.IN},{type:m.IN},{type:O.D},{type:_e.YP},{type:ge.n}],P.propDecorators={projeto_id:[{type:d.IIB}]},P=(0,c.gn)([(0,d.wA2)({selector:"app-projeto-contratos-lista",template:'<ion-content appScrollTheme>\n  <div *ngIf="projeto" class="surface-ground pt-2 pb-3 h-full">\n    <div class="surface-section px-4 pt-2 mb-3">\n      <div class="text-3xl font-medium text-900 mb-3">Contratos associados ao projeto: {{ projeto.nome }}</div>\n      <div class="surface-border border-top-1 opacity-50 w-full"></div> \n    </div>\n\n    <div class="surface-ground px-6 grid formgrid p-fluid">\n      <div *ngFor="let c of projeto.contratos" class="col-12 md:col-6 xl:col-4 p-3 ">\n        <div class="surface-card shadow-2 border-round p-4 ">\n          <div class="flex border-bottom-1 surface-border pb-4">\n            <div class="flex flex-column align-items-start">\n              <span class="text-2xl text-900 font-medium mb-2">{{ c.nome }}\n                <div class="text-xl text-700 font-medium mb-3">{{ c.descricao | limitCharsPipe }}</div>\n              </span>\n              <div class="text-500 font-medium mb-1">Situa\xe7\xe3o: {{ c.status }}</div>\n              <div class="text-500 font-medium mb-3">Tipo: {{ c.tipo }}</div>\n\n              <div class="text-500 font-medium mb-1">Recorr\xeancia de PGTO: {{ c.recorrencia_pagamento }}</div>\n              <div class="text-500 font-medium mb-1">Condi\xe7\xe3o de PGTO: {{ c.condicao_pagamento }}</div>\n\n              <div class="mt-4"></div>\n            </div>\n          </div>\n          <div class="flex justify-content-between pt-4 ">\n            <button pButton pRipple label="Remover" icon="pi pi-times" class="p-button-outlined p-button-danger  ml-2"\n              (click)="desassociar(c)"></button>\n              <button pButton pRipple label="Detalhar" icon="pi pi-eye" class=" ml-2"\n                (click)="detailContrato(c)"></button>\n          </div>\n        </div>\n      </div>\n\n      \n      <div *ngIf="contratos" class="surface-ground col-12 md:col-6 xl:col-4 p-3">\n        <form [formGroup]="form" (ngSubmit)="$event.preventDefault()">\n          <div class="surface-card shadow-2 border-round p-4">\n            <div class="grid flex border-bottom-1 surface-border pb-4">\n              <div class="col-12 field mb-5">\n                <label for="contratos" class="text-900 font-medium mb-3">Associar contrato</label>\n                <div class="ml-3 cursor-pointer pi pi-question-circle" (click)="detailContrato()"></div>\n                <p-dropdown id="contratos" #drop_contrato [options]="contratos.data" [filter]="true"\n                  placeholder="Selecione" [virtualScroll]="true" [virtualScrollItemSize]="38" [lazy]="true"\n                  [virtualScrollOptions]="{ showLoader: true, loading: loading, delay: 250 }" formControlName="contrato"\n                  optionLabel="nome" filterBy="nome">\n                  <ng-template pTemplate="filter" let-options="options">\n                    <div class="flex p-3">\n                      <div class="p-inputgroup" (click)="$event.stopPropagation()">\n                        <input #searchContrato type="text" pInputText placeholder="Procurar">\n                        <button pButton pRipple icon="pi pi-search" (click)="paginar(searchContrato)"></button>\n                      </div>\n                    </div>\n                  </ng-template>\n                  <ng-template pTemplate="loader" let-options="options">\n                    <div class="flex align-items-center py-2 px-3" style="height: 38px">\n                      <p-skeleton [width]="options.even ? \'60%\' : \'50%\'" height="1rem"></p-skeleton>\n                    </div>\n                  </ng-template>\n                  <ng-template let-contrato pTemplate="item">\n                    <div>\n                      <div>{{ contrato.nome }}</div>\n                    </div>\n                  </ng-template>\n                  <ng-template let-contrato pTemplate="selectedItem">\n                    <div>\n                      <div>{{ contrato.nome }}</div>\n                    </div>\n                  </ng-template>\n                </p-dropdown>\n                <div class="flex mt-1 justify-content-end">\n                  <p-message severity="error" text="Obrigat\xf3rio" *ngIf="isInputError(\'contrato\')"></p-message>\n                </div>\n              </div>\n            </div>\n            <div class="flex justify-content-between pt-4">\n              <button pButton pRipple label="Associar" icon="pi pi-plus"\n                [disabled]="disableAssociarProjetoBtn()" class="w-6 ml-2" (click)="associar()"></button>\n            </div>\n          </div>\n        </form>\n      </div>\n    </div>\n  </div>\n\n  <p-confirmDialog acceptLabel="Sim" rejectLabel="N\xe3o" [style]="{width: \'50vw\'}" [baseZIndex]="10000"\n    rejectButtonStyleClass="p-button-text"></p-confirmDialog>\n\n</ion-content>\n\n<ion-footer>\n  <ion-toolbar>\n    <ion-button expand="full" color="danger" (click)="fechar()">Fechar</ion-button>\n  </ion-toolbar>\n</ion-footer>',styles:[""]})],P);let w=class{constructor(e,t,o,s,r,n,f,g){this.formBuilder=e,this.userService=t,this.modalPet=o,this.modalBrief=s,this.toastService=r,this.confirmationService=n,this.filesService=f,this.projetosService=g,this.searchedAssociado=void 0,this.searchedAssociadoTipo=void 0,this.searchedUser="",this.showUserDialog=!1,this.shouldUpdate=!1,this.showDialog=!1,this.currentPage=1,this.pageOrder=v.L.DESC,this.currentTake=5,this.UserTipoSelect=b.om.filter(y=>y.value==b.Wo.PRESTADOR||y.value==b.Wo.SISTEMA),this.cols=[{field:"id",header:"ID"},{field:"associado.nome",header:"Nome"},{field:"associado.tipo_user",header:"Tipo de usu\xe1rio"}],this.opcoesMenuItens=[{label:"Baixar",items:[{label:"CSV",icon:"pi pi-file-o",command:()=>this.exportCsv()},{label:"XLSX",icon:"pi pi-file-excel",command:()=>this.exportExcel()},{label:"PDF",icon:"pi pi-file-pdf",command:()=>this.exportPdf()}]}],this.subscriptions=new X.w0}ngOnInit(){this.form=this.formBuilder.group({user:[,[l.kI.required]]}),this.loadAssociados(),this.loadUsers()}ngOnDestroy(){this.subscriptions.unsubscribe()}loadAssociados(e=1,t){const o=this.userService.listUsers({projeto_id:this.projeto.id,searchedUser:this.searchedAssociado,tipo_user:this.searchedAssociadoTipo},{order:this.pageOrder,page:e,take:this.currentTake}).subscribe({next:s=>{this.associados=s},complete:()=>{t&&(t.paginator=!0)}});this.subscriptions.add(o)}loadUsers(e=1,t){const o=this.userService.listUsers({searchedUser:this.searchedUser,tipos_usarios:`${b.Wo.COLABORADOR}, ${b.Wo.PRESTADOR}`},{order:v.L.ASC,page:e,take:10}).subscribe(s=>{this.users=s,t&&t.show()});this.subscriptions.add(o)}paginar(e,t){t.paginator=!1;const{first:o,rows:s,sortOrder:r}=e,n=Number(Number(o)/Number(s)+1);this.doFilter(e),this.currentPage=n,this.currentTake=s,this.pageOrder=r&&1==r?v.L.DESC:v.L.ASC,this.loadAssociados(n,t)}associar(){const e=this.form.get("user").value;if(console.log(e),e.alocacao_projetos&&e.alocacao_projetos.length>=1)return void this.forceAssociar();const t=e.id,o=this.projetosService.updateAlocacao(this.projeto.id,{users:[t]}).subscribe({next:s=>{this.loadAssociados(),this.toastService.presentToast({titulo:"Sucesso",detalhe:"Opera\xe7\xe3o bem sucedida!",duracao:i.m4.shortDuration,gravidade:i.kl.SUCESSO}),this.form.reset()}});this.subscriptions.add(o)}forceAssociar(){const e=this.form.get("user").value,t=e.id,o=e.alocacao_projetos.map(r=>`- ${r.nome}`).join("<br>"),s=`\n    O usu\xe1rio ${e.nome}, j\xe1 se encontra alocado no(s) projeto(s):\n    <br><br>${o}\n    `;this.confirmationService.confirm({message:s,header:"Deseja adicion\xe1-lo a mais um projeto?",icon:"pi pi-exclamation-triangle",accept:()=>{const r=this.projetosService.updateAlocacao(this.projeto.id,{users:[t]}).subscribe(n=>{this.loadAssociados(),this.toastService.presentToast({titulo:"Sucesso",detalhe:"Opera\xe7\xe3o bem sucedida!",duracao:i.m4.shortDuration,gravidade:i.kl.SUCESSO}),this.form.reset()});this.subscriptions.add(r)},reject:r=>{this.toastService.clearToast()}})}desassociar(e){this.confirmationService.confirm({message:`Deseja desassociar "${e.nome}" ?`,header:"Desssocia\xe7\xe3o",icon:"pi pi-exclamation-triangle",accept:()=>{const t=this.projetosService.updateDeslocacao(this.projeto.id,{users:[e.id]}).subscribe(o=>{this.loadAssociados(),this.toastService.presentToast({titulo:"Sucesso!",detalhe:"Desassociado com sucesso.",duracao:i.m4.shortDuration,gravidade:i.kl.SUCESSO}),this.form.reset()});this.subscriptions.add(t)},reject:t=>{this.toastService.clearToast()}})}fechar(){this.modalPet.dismiss(this.shouldUpdate)}isInputError(e){return!(this.form.controls[e].untouched||!this.form.controls[e].errors)}disableCreateBtn(){return!this.form.valid}searchUser({value:e}){this.searchedUser=e,this.loadUsers(1)}clearUser(e){e.value="",this.searchedUser="",this.loadUsers(1)}detailUser(e){this.selectedUser=e||this.form.get("user").value,this.selectedUser?this.showModal(he.Q,{user:this.selectedUser}):this.toastService.presentToast({detalhe:"Selecione uma op\xe7\xe3o primeiro",titulo:"Sele\xe7\xe3o necess\xe1ria",duracao:i.m4.shortDuration,gravidade:i.kl.INFORMACAO})}doFilter(e){if(!e||!e.filters||!e.filters.tipo)return;const{tipo:t}=e.filters;t[0].value?this.searchedAssociadoTipo=t[0].value:this.searchedAssociadoTipo=void 0}exportPdf(){var e=this;return(0,u.Z)(function*(){const t=`${e.projeto.nome}_Alocacao - ${(new Date).toLocaleDateString()}`,o=e.cols.map(r=>r.header),s=e.convertAssociadoData().map(Object.values);yield e.filesService.exportPdf(t,o,s)})()}exportExcel(){var e=this;return(0,u.Z)(function*(){const t=`${e.projeto.nome}_Alocacao - ${(new Date).toLocaleDateString()}`;yield e.filesService.exportExcel(t,e.convertAssociadoData())})()}exportCsv(){var e=this;return(0,u.Z)(function*(){const t=`${e.projeto.nome}_Alocacao - ${(new Date).toLocaleDateString()}`;yield e.filesService.exportCSV(t,e.convertAssociadoData())})()}convertAssociadoData(){return this.associados.data.map(t=>({id:t.id,nome:t.nome,tipo_user:t.tipo_user}))}showModal(e,t){var o=this;return(0,u.Z)(function*(){const s=yield o.modalBrief.create({component:e,backdropDismiss:!1,cssClass:"modal-size-100",componentProps:t});return s.onDidDismiss().then(r=>{}),yield s.present()})()}};w.ctorParameters=()=>[{type:l.QS},{type:fe.K},{type:m.IN},{type:m.IN},{type:O.D},{type:_e.YP},{type:ge.n},{type:E.T}],w.propDecorators={projeto:[{type:d.IIB}]},w=(0,c.gn)([(0,d.wA2)({selector:"app-projeto-alocados-lista",template:'<ion-content class="" appScrollTheme>\n\n  <div *ngIf="projeto" class="surface-ground pt-2 pb-3 h-screen">\n    <div class="surface-section px-4 pt-2 mb-3 ">\n      <div class="text-3xl font-medium text-900 mb-3">Usu\xe1rios alocados ao projeto: {{ projeto.nome }}</div>\n      <div class="surface-border border-top-1 opacity-50 w-full"></div>\n    </div>\n\n    <form [formGroup]="form" (ngSubmit)="$event.preventDefault()">\n      <div class="surface-ground px-6 py-3 justify-content-start w-auto sm:w-30rem">\n        <div class="surface-card p-4 shadow-2 border-round p-fluid">\n          <div class="grid formgrid p-fluid">\n            <div *ngIf="users" class="col-12 field ">\n              <label for="users" class="text-900 font-medium mb-3">Alocar usu\xe1rio</label>\n              <div class="ml-3 cursor-pointer pi pi-question-circle" (click)="detailUser()"></div>\n              <p-dropdown id="users" [options]="users.data" [filter]="true" placeholder="Selecione"\n                [virtualScroll]="true" [virtualScrollItemSize]="38" [lazy]="true" formControlName="user"\n                optionLabel="nome" filterBy="nome, cpf" [showClear]="true" styleClass="w-full">\n                <ng-template pTemplate="filter" let-options="options">\n                  <div class="flex p-3">\n                    <div class="p-inputgroup" (click)="$event.stopPropagation()">\n                      <input #searchUserInput type="text" pInputText placeholder="Procurar"\n                        (keyup.enter)="searchUser(searchUserInput)" class="w-full">\n                      <button pButton pRipple icon="pi pi-search" (click)="searchUser(searchUserInput)"></button>\n                      <button class="p-button-outlined" pButton pRipple icon="pi pi-times"\n                        (click)="clearUser(searchUserInput)"></button>\n                    </div>\n                  </div>\n                </ng-template>\n                <ng-template pTemplate="loader" let-options="options">\n                  <div class="flex align-items-center py-2 px-3" style="height: 38px">\n                    <p-skeleton width="50%" height="1rem"></p-skeleton>\n                  </div>\n                </ng-template>\n                <ng-template let-user pTemplate="item">\n                  <div>\n                    <div>{{ user.nome}} - {{ user.cpf | cpfMask }}</div>\n                  </div>\n                </ng-template>\n                <ng-template let-user pTemplate="selectedItem">\n                  <div>{{ user.nome}} - {{ user.cpf | cpfMask }}</div>\n                </ng-template>\n              </p-dropdown>\n            </div>\n            <div class="surface-border border-top-1 opacity-50 mb-4 col-12"></div>\n          </div>\n          <div class="flex justify-content-end">\n            <button pButton pRipple label="Alocar" icon="pi pi-send" iconPos="right" class="w-auto"\n              (click)="associar()" [disabled]="disableCreateBtn()"></button>\n          </div>\n        </div>\n      </div>\n    </form>\n\n    <div class="surface-border border-top-1 opacity-50 w-full"></div>\n\n    <div class="surface-ground  px-6 grid formgrid p-fluid mt-2 mb-8 ">\n      <div *ngIf="associados" class="col-12">\n        <p-table #dt [value]="associados.data" dataKey="id" [rowHover]="true" [showCurrentPageReport]="true"\n          [rowsPerPageOptions]="[5,10,25,50]" [globalFilterFields]="[\'nome\',\'id\', \'tipo\', \'cpf\']" [filterDelay]="2"\n          currentPageReportTemplate="Mostrando {first} at\xe9 {last} de {totalRecords} associados" [lazy]="true"\n          [value]="associados.data" [paginator]="true" [rows]="associados.meta.take"\n          [totalRecords]="associados.meta.itemCount" [pageLinks]="associados.meta.pageCount"\n          (onLazyLoad)="paginar($event, dt)" responsiveLayout="scroll" styleClass="p-datatable-striped">\n          <ng-template pTemplate="caption">\n            <div class="grid flex">\n\n              <div class="table-header text-primary col-6">\n                Usu\xe1rios\n              </div>\n              <div class="col-6 justify-content-end text-right mb-1">\n                \x3c!--\n                <button type="button" pButton pRipple icon="pi pi-file-o" (click)="exportCsv()"\n                  class="p-button-help mr-2" pTooltip="CSV" tooltipPosition="bottom"></button>\n\n                <button type="button" pButton pRipple icon="pi pi-file-excel" (click)="exportExcel()"\n                  class="p-button-success mr-2" pTooltip="XLS" tooltipPosition="bottom"></button>\n\n                <button type="button" pButton pRipple icon="pi pi-file-pdf" (click)="exportPdf()"\n                  class="p-button-danger mr-2" pTooltip="PDF" tooltipPosition="bottom"></button>\n--\x3e\n                <button type="button" pButton icon="pi pi-download" (click)="editMenu.toggle($event)"></button>\n                <p-menu #editMenu appendTo="body" [popup]="true" [model]="opcoesMenuItens"></p-menu>\n              </div>\n\n              <div class="col-12 justify-content-start mt-3 mb-1">\n                <span class="p-inputgroup mb-2 md:mb-0 mt-2 max-w-30rem\t">\n                  <input class="w-full" type="search" pInputText [(ngModel)]="searchedAssociado"\n                    [ngModelOptions]="{standalone: true}" placeholder="CPF, Email ou Nome"\n                    (keyup.enter)="loadAssociados()">\n                  <button type="button" pButton pRipple class="pi pi-search cursor-pointer p-button-outlined"\n                    (click)="loadAssociados()"></button>\n                  <button type="button" pButton pRipple\n                    class="pi pi-times cursor-pointer p-button-outlined p-button-danger"\n                    (click)="searchedAssociado = \'\'; loadAssociados();"></button>\n                </span>\n              </div>\n\n            </div>\n          </ng-template>\n\n          <ng-template pTemplate="header">\n            <tr>\n              <th style="width: 15rem;">\n                <div class="text-center">\n                  <span class="mx-2">ID</span>\n                </div>\n              </th>\n              <th style="min-width: 10rem">\n                <div class="text-center">\n                  <span class="mx-2">Nome</span>\n                </div>\n              </th>\n              <th style="min-width: 10rem">\n                <div class="text-center">\n                  <span class="mx-2">CPF</span>\n                </div>\n              </th>\n              <th style="min-width: 10rem">\n                <div class="text-center">\n                  <span class="mx-2">Tipo</span>\n\n                  <p-columnFilter field="tipo" matchMode="between" display="menu" [showMatchModes]="false"\n                    [showOperator]="false" [showAddButton]="false" class="ml-auto">\n                    <ng-template pTemplate="filter" let-value let-filter="filterCallback">\n                      <p-dropdown [ngModel]="value" [options]="UserTipoSelect" (onChange)="filter($event.value)"\n                        placeholder="Tipo de Usu\xe1rio">\n                        <ng-template let-option pTemplate="item">\n                          <div class="mb-2">\n                            <span class="font-light px-2 " style="border-radius: 30px;">{{option.label}}</span>\n                          </div>\n                        </ng-template>\n                      </p-dropdown>\n                    </ng-template>\n                  </p-columnFilter>\n                </div>\n              </th>\n              <th style="width: 15rem"></th>\n            </tr>\n          </ng-template>\n\n          <ng-template pTemplate="body" let-associado>\n            <tr class="p-selectable-row mb-8">\n              <td class="text-center">\n                <span class="p-column-title">id</span>\n                <span class="image-text"> {{associado.id}} </span>\n              </td>\n              <td class="text-center">\n                <span class="p-column-title">Nome</span>\n                <img [src]="associado.cliente?.avatar_url || \'assets/imgs/outros/default-user.jpg\'" width="32"\n                  height="32" class="mr-1 border-circle border-2 border-primary" style="vertical-align: middle" />\n                <br><br>\n                <span class="image-text"> {{associado.nome}} </span>\n              </td>\n              <td class="text-center">\n                <span class="p-column-title">cpf</span>\n                <span class="image-text"> {{ associado.cpf ? (associado.cpf | cpfMask) : \'N\xe3o informado\' }}</span>\n              </td>\n              <td class="text-center">\n                <span class="p-column-title">tipo</span>\n                <span class="image-text"> {{associado.tipo_user}} </span>\n              </td>\n              <td style="text-align: center">\n                <button pButton type="button" class="p-button-danger p-button-outlined" icon="pi pi-times"\n                  (click)="desassociar(associado)"></button>\n                <button pButton type="button" class="p-button-primary ml-0 mt-2 md:ml-3 lg:mt-0" icon="pi pi-eye"\n                  (click)="detailUser(associado)"></button>\n              </td>\n            </tr>\n          </ng-template>\n\n          <ng-template pTemplate="emptymessage">\n            <tr>\n              <td colspan="8">Nenhum usu\xe1rio associado.</td>\n            </tr>\n          </ng-template>\n        </p-table>\n      </div>\n    </div>\n  </div>\n\n  <p-confirmDialog acceptLabel="Sim" rejectLabel="N\xe3o" [style]="{width: \'50vw\'}" [baseZIndex]="10000"\n    rejectButtonStyleClass="p-button-text"></p-confirmDialog>\n\n</ion-content>\n\n<ion-footer>\n  <ion-toolbar>\n    <ion-button expand="full" color="danger" (click)="fechar()">Fechar</ion-button>\n  </ion-toolbar>\n</ion-footer>',styles:[""]})],w);let Q=class{constructor(e,t,o,s){var n,r=this;this.projetosService=e,this.projetosReportService=t,this.modal=o,this.toastService=s,this.ProjetoStatusSelect=h.sB,this.isLoaded=!1,this.searchedProjeto="",this.selectedProjetoStatus=void 0,this.currentPage=1,this.showStatusDialog=!1,this.editMenuItens=[{label:"Op\xe7\xf5es",items:[{label:"Atualizar",icon:"pi pi-user-edit",command:()=>this.detalharSimplificado(this.selectedProjeto)},{label:"Status",icon:"pi pi-exclamation-triangle",command:()=>this.detalharStatus(this.selectedProjeto)}]},{separator:!0,items:[{label:"Lista de Contratos",icon:"pi pi-list",command:()=>this.detalharContratos(this.selectedProjeto)},{label:"Usu\xe1rios Alocados",icon:"pi pi-users",command:()=>this.detalharAlocacao(this.selectedProjeto)}]},{separator:!0,items:[{label:"Baixar",icon:"pi pi-file-pdf",command:(n=(0,u.Z)(function*(){return yield r.detalharPdf(r.selectedProjeto)}),function(){return n.apply(this,arguments)})}]}],this.updateStatusObj={status_projeto:void 0},this.showUserList=!1,this.contentError=new Me.S,this.subscriptions=new X.w0}ngOnInit(){this.loadProjetos()}ngOnDestroy(){this.subscriptions.unsubscribe()}changeStatus({value:e}){this.selectedProjetoStatus=e,this.loadProjetos(1)}clearFilter(){this.loadProjetos(1)}clearAllFilters(e,t,o){this.searchedProjeto=void 0,this.selectedProjetoStatus=void 0,t.writeValue(null),o.writeValue(null),this.loadProjetos(1)}loadProjetos(e=1){const t=this.projetosService.list({searchedProjeto:this.searchedProjeto,status:this.selectedProjetoStatus},{order:v.L.DESC,page:e,take:5}).subscribe({next:o=>{this.contentError=new Me.S,this.projetos=o,this.isLoaded=!0},error:o=>{this.contentError={code:o.status,hasError:!0}}});this.subscriptions.add(t)}updateStatus(){const{id:e}=this.selectedProjeto,{status_projeto:t}=this.updateStatusObj,o=this.projetosService.update({status:t},e).subscribe({next:s=>{this.toastService.presentToast({titulo:"Sucesso",detalhe:"Opera\xe7\xe3o bem sucedida!",duracao:i.m4.mediumDuration,gravidade:i.kl.SUCESSO}),this.showStatusDialog=!1,this.loadProjetos(1)},error:s=>{this.showStatusDialog=!1}});this.subscriptions.add(o)}detalharSimplificado(e){this.showModal(C,{projeto:e})}detalharStatus(e){const{status:t}=e;this.updateStatusObj={status_projeto:t},this.showStatusDialog=!0}detalharContratos(e){this.showModal(P,{projeto_id:e.id})}detalharAlocacao(e){this.showModal(w,{projeto:e})}detalharPdf(e){var t=this;return(0,u.Z)(function*(){t.toastService.presentToast({titulo:"Em breve",detalhe:"Essa op\xe7\xe3o estar\xe1 dispon\xedvel em breve",duracao:i.m4.shortDuration,gravidade:i.kl.ATENCAO})})()}createNew(){this.showModal(N)}search(){this.loadProjetos(1)}paginar(e){const{first:t,rows:o}=e,s=Number(Number(t)/Number(o)+1);s!=this.currentPage&&(this.currentPage=s,this.loadProjetos(s))}showModal(e,t){var o=this;return(0,u.Z)(function*(){const s=yield o.modal.create({component:e,backdropDismiss:!1,cssClass:"modal-size-100",componentProps:t});return s.onDidDismiss().then(r=>{const{data:n}=r;o.isLoaded=!1,o.loadProjetos(),!0===n&&o.toastService.presentToast({titulo:"Sucesso",detalhe:"Opera\xe7\xe3o bem sucedida!",duracao:i.m4.mediumDuration,gravidade:i.kl.SUCESSO})}),yield s.present()})()}};Q.ctorParameters=()=>[{type:E.T},{type:ee},{type:m.IN},{type:O.D}],Q=(0,c.gn)([(0,d.wA2)({selector:"app-projeto-main",template:'<div class="pt-3 card main-view h-full">\n\n  <ng-container *ngIf="isLoaded">\n    <p-dataView emptyMessage="Nada encontrado, experimente escolher outro filtro" class="data-container" #dv\n      [lazy]="true" [value]="projetos.data" [paginator]="true" [rows]="projetos.meta.take"\n      [totalRecords]="projetos.meta.itemCount" [pageLinks]="projetos.meta.pageCount" (onLazyLoad)="paginar($event)"\n      filterBy="nome" layout="list">\n      <ng-template pTemplate="header">\n\n        <div class="flex grid formgrid p-fluid justify-content-between mb-2">\n          <div class="field mb-2 col-12 md:col-6 lg:col-3">\n            <p-dropdown #dropdown_filtro [options]="ProjetoStatusSelect" placeholder="Status"\n              (onChange)="changeStatus($event)" (onClear)="clearFilter($event)" [showClear]="true"\n              styleClass="mb-2 md:mb-0 w-full"></p-dropdown>\n          </div>\n        </div>\n\n        <div class="flex grid formgrid p-fluid justify-content-between mb-2">\n          <div class="field col-12 md:col-4">\n            <button pButton pRipple class=" md:w-auto w-full p-button-outlined" icon="pi pi-times"\n              label="Limpar filtros" (click)="clearAllFilters($event, dropdown_lojas, dropdown_filtro)">\n            </button>\n          </div>\n          <div class="field col-12 md:col-2  text-right">\n            <button pButton pRipple class="md:w-auto w-full " icon="pi pi-plus" label="Novo cadastro"\n              (click)="createNew()">\n            </button>\n          </div>\n        </div>\n\n        <div class="flex flex-column md:flex-row md:justify-content-center">\n          <span class="p-inputgroup mb-2 md:mb-0 mt-2 max-w-30rem\t">\n            <input class="w-full" type="search" pInputText [(ngModel)]="searchedProjeto"\n              [ngModelOptions]="{standalone: true}" placeholder="Nome, c\xf3digo ou ID do projeto"\n              (keyup.enter)="search()">\n            <button type="button" pButton pRipple class="pi pi-search cursor-pointer p-button-outlined"\n              (click)="search()"></button>\n            <button type="button" pButton pRipple class="pi pi-times cursor-pointer p-button-outlined p-button-danger"\n              (click)="searchedProjeto = \'\'; search();"></button>\n          </span>\n        </div>\n\n      </ng-template>\n\n      <ng-template let-projeto pTemplate="listItem">\n        <div *ngIf="isLoaded" #templateGrid class="col-12">\n          <div class="data-list-item">\n            <div class="data-list-detail">\n              <div class="data-name">{{ projeto.id }}</div>\n              <div class="data-description mt-2">Nome: {{ projeto.nome }}</div>\n              <div class="data-description mt-1">Custo: {{ projeto.custo_projeto ? (projeto.custo_projeto |\n                currency:\'BRL\': \'(R$)\') :\n                \'N\xe3o informado\'\n                }}</div>\n              <div class="data-description mt-1">Valor a ser cobrado: {{ projeto.valor_cobrado ? (projeto.valor_cobrado\n                | currency:\'BRL\': \'(R$)\') :\n                \'N\xe3o informado\'\n                }}</div>\n\n              <div class="data-description mt-2">Situa\xe7\xe3o: {{ projeto.status }}</div>\n              <div class="data-description mt-1">Tipo: {{ projeto.tipo || \'N\xe3o informado\' }}</div>\n              <div class="data-description mt-1">Categoria: {{ projeto.categoria || \'N\xe3o informado\' }}</div>\n\n              <div class="data-description mt-2">Empresa detentora: {{ projeto.empresa_detentora?.razao_social || \'N\xe3o\n                informado\' }}\n              </div>\n              <div class="data-description mt-1">Respons\xe1vel: {{ projeto.responsavel?.nome || \'N\xe3o informado\' }}\n              </div>\n            </div>\n\n            <div class="data-list-action">\n              <button type="button" pButton icon="pi pi-cog" label="Op\xe7\xf5es"\n                (click)="selectedProjeto = projeto; editMenu.toggle($event)"></button>\n              <p-menu #editMenu appendTo="body" [popup]="true" [model]="editMenuItens"></p-menu>\n            </div>\n          </div>\n\n        </div>\n      </ng-template>\n    </p-dataView>\n  </ng-container>\n\n  <ng-container *ngIf="contentError.hasError">\n    <app-content-error [erroCode]="contentError.code"></app-content-error>\n  </ng-container>\n\n\n  <p-dialog *ngIf="showStatusDialog" [(visible)]="showStatusDialog" [resizable]="false" [draggable]="false"\n    [modal]="true" [breakpoints]="{\'960px\': \'75vw\', \'640px\': \'100vw\'}" [style]="{width: \'40vw\', height: \'80%\'}">\n    <ng-template pTemplate="header">\n      <div class="flex align-items-center">\n        <div class="text-900 font-medium mb-3 text-xl">Alterando status</div>\n      </div>\n    </ng-template>\n    <div class="surface-card border-round shadow-2 p-4">\n      <p class="mt-0 mb-4 p-0 line-height-3">Situa\xe7\xe3o: </p>\n      <p-dropdown [options]="ProjetoStatusSelect" emptyMessage="Nada dispon\xedvel" placeholder="Selecione"\n        [(ngModel)]="updateStatusObj.status_projeto" [ngModelOptions]="{standalone: true}"\n        styleClass="mb-2 md:mb-0 w-full">\n      </p-dropdown>\n    </div>\n    <div class="flex justify-content-end mt-3 grid">\n      <div class="surface-border border-top-1 opacity-50 mb-1 col-12"></div>\n      <button class="" pButton pRipple label="Atualizar" (click)="updateStatus()"></button>\n    </div>\n  </p-dialog>\n</div>',styles:[""]})],Q);let te=class{};te=(0,c.gn)([(0,d.LVF)({declarations:[Q],imports:[x.ez,l.u5,l.UX,m.Pc,re.FI,ue.QK,j.j,le.A,T.T,$.l,F.x,ve.F,V.$9,de.U,pe.cc,ne.Q,ce.ON,k.kW,ie.LU,j.j,me.S,D.hJ,L.O,z.D,Ge.f,S.o,W.X,Z.R],exports:[Q]})],te);var ke=a(28396),lt=a(58949);let xe=class{};xe=(0,c.gn)([(0,d.LVF)({declarations:[I],imports:[x.ez,m.Pc,D.hJ,T.T,S.o],exports:[I]})],xe);let oe=class{};oe=(0,c.gn)([(0,d.LVF)({declarations:[P],imports:[x.ez,l.u5,l.UX,m.Pc,T.T,$.l,j.j,F.x,k.kW,V.$9,D.hJ,L.O,ke.U$,z.D,S.o,W.X,Z.R,lt.d,xe],exports:[P]})],oe);let se=class{};se=(0,c.gn)([(0,d.LVF)({declarations:[w],imports:[x.ez,l.u5,l.UX,m.Pc,T.T,$.l,j.j,F.x,k.kW,V.$9,D.hJ,L.O,ke.U$,z.D,S.o,W.X,Z.R,be.B],exports:[w]})],se);let je=class{};je=(0,c.gn)([(0,d.LVF)({declarations:[],imports:[x.ez,Y,q,te,oe,se],exports:[Y,q,te,oe,se]})],je);let ye=class{};ye=(0,c.gn)([(0,d.LVF)({imports:[x.ez,l.u5,m.Pc,Le.uH,ae,je,S.o],declarations:[_]})],ye)}}]);