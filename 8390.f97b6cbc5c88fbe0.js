"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8390],{88390:(M,h,t)=>{t.r(h),t.d(h,{GestaoAssinaturasPageModule:()=>P});var d=t(70655),l=t(98274),a=t(36895),o=t(24006),c=t(48058),u=t(39528);let v=class{constructor(){}ngOnInit(){}};v.ctorParameters=()=>[],v=(0,d.gn)([(0,l.wA2)({selector:"app-gestao-assinaturas",template:'<ion-header [translucent]="true">\n  <ion-toolbar>\n    <ion-buttons slot="start">\n      <ion-menu-button></ion-menu-button>\n    </ion-buttons>\n    <ion-title>Gest\xe3o de assinaturas</ion-title>\n  </ion-toolbar>\n</ion-header>\n\n<ion-content appScrollTheme>\n  <div class="wall-background py-5">\n    <div style="max-width: 95%; max-height: 95%; margin: auto">\n      <app-assinaturas-gestao-main></app-assinaturas-gestao-main>\n    </div>\n  </div>\n</ion-content>',styles:[""]})],v);const I=[{path:"",component:v}];let y=class{};y=(0,d.gn)([(0,l.LVF)({imports:[u.Bz.forChild(I)],exports:[u.Bz]})],y);var b=t(35593),S=t(91795),L=t(17913),B=t(50613),T=t(51740),R=t(1997),U=t(25047),x=t(21493),K=t(82210),W=t(15108),w=t(45132),F=t(77604),z=t(9764),k=t(21327),$=t(92665),j=t(17489),N=t(70585),V=t(32137),G=t(15861);var Q=t(10805),X=t(50727),Y=t(54452),A=t(59136),m=t(98739),Z=t(59256),p=t(67935),q=t(42732),tt=t(93922),et=t(34758),st=t(18109),at=t(20533);let _=class{constructor(e,s,n,i,g,D,lt,ot){this.userService=e,this.modal=s,this.toastService=n,this.planoService=i,this.router=g,this.assinaturasService=D,this.storageService=lt,this.confirmationService=ot,this.searchedAssinatura="",this.currentPage=1,this.searchedCliente="",this.selectedCliente="",this.searchedPlano="",this.selectedPlano="",this.shouldDisableCliente=!1,this.sortOptions=[],this.isLoaded=!1,this.showEnderecoDialog=!1,this.showServicoDialog=!1,this.subscriptions=new X.w0}ngOnInit(){this.sortOptions=[...p.m],this.loadPlanos(),this.loadClientes(),this.loadAssinatura()}ngOnDestroy(){this.subscriptions.unsubscribe()}changeFiltro({value:e}){this.selectedStatusAssinatura=e,this.loadAssinatura()}clearFilter(){this.loadAssinatura()}clearAllFilters(e,s,n){this.searchedAssinatura=void 0,this.selectedPlano=void 0,this.clearPlanoFilter(null),s.writeValue(null),n.writeValue(null),this.loadClientes(1)}createNewAssinatura(){this.router.navigateByUrl("plano-assinaturas")}setUserImage(e){return e.avatar_url||"assets/imgs/outros/default-user.jpg"}changePlano({value:e}){this.selectedPlano=e,this.loadAssinatura()}clearPlanoFilter(e){this.shouldDisableCliente=!0,this.selectedCliente=void 0,this.selectedStatusAssinatura=void 0}loadPlanos(e=1,s){const n=this.planoService.list({searchedPlano:this.searchedPlano},{order:A.L.ASC,page:e,take:10}).subscribe(i=>{this.planos=i,s&&s.show()});this.subscriptions.add(n)}paginarPlanos(e){this.loadPlanos()}onPlanoFilter(e){const s=e.filter;this.searchedPlano=s}blurPlanos(e,s){this.searchedPlano=void 0,s.filterValue=void 0}changeCliente({value:e}){this.loadAssinatura()}loadClientes(e=1){const s=this.userService.listUsers({searchedUser:this.searchedCliente,tipo_usuario:st.X.CLIENTE,load_cliente_nao_identificado:!0},{order:A.L.DESC,page:e,take:10}).subscribe(n=>{this.clientes=n});this.subscriptions.add(s)}paginarCliente(e){this.loadClientes()}onClienteFilter(e){const s=e.filter;this.searchedCliente=s,this.loadClientes()}blurCliente(e,s){this.searchedCliente=void 0,s.filterValue=void 0}searchAssinatura(){this.loadAssinatura(1)}paginarAssinatura(e){const{first:s,rows:n}=e,i=Number(Number(s)/Number(n)+1);i!=this.currentPage&&(this.currentPage=i,this.loadAssinatura(i))}loadAssinatura(e=1){const s=this.assinaturasService.list({plano_assinatura_id:this.selectedPlano,assinante_id:this.selectedCliente,searchedAssinatura:this.searchedAssinatura,status:this.selectedStatusAssinatura},{order:A.L.DESC,page:e,take:10}).subscribe(n=>{this.assinaturas=n});this.subscriptions.add(s)}openDetailAssinatura(e){this.showModal(at.Y,{assinatura_id:e.id})}startAssinatura(e){const{id:s,assinante:n}=e;this.confirmationService.confirm({message:`Deseja mesmo ativar a assinatura ${s}?`,header:`Assinatura do cliente '${n.nome}'`,icon:"pi pi-exclamation-triangle",accept:()=>{const i=this.assinaturasService.startById(s).subscribe(g=>{this.toastService.presentToast({titulo:"Ativada",detalhe:`Assinatura do cliente '${n.nome}' ativada`,duracao:m.m4.mediumDuration,gravidade:m.kl.INFORMACAO}),this.loadAssinatura()});this.subscriptions.add(i)},reject:i=>{this.toastService.clearToast()}})}pauseAssinatura(e){const{id:s,assinante:n}=e;this.confirmationService.confirm({message:`Deseja mesmo pausar a assinatura ${s}?`,header:`Assinatura do cliente '${n.nome}'`,icon:"pi pi-exclamation-triangle",accept:()=>{const i=this.assinaturasService.pausadaById(s).subscribe(g=>{this.toastService.presentToast({titulo:"Pausada",detalhe:`Assinatura do cliente '${n.nome}' foi pausada`,duracao:m.m4.mediumDuration,gravidade:m.kl.INFORMACAO}),this.loadAssinatura(1)});this.subscriptions.add(i)},reject:i=>{this.toastService.clearToast()}})}cancelAssinatura(e){const{id:s,assinante:n}=e;this.confirmationService.confirm({message:`Deseja mesmo cancelar a assinatura ${s}?`,header:`Assinatura do cliente '${n.nome}'`,icon:"pi pi-exclamation-triangle",accept:()=>{const i=this.assinaturasService.cancelById(s).subscribe(g=>{this.toastService.presentToast({titulo:"Cancelada",detalhe:`Assinatura do cliente '${n.nome}' cancelada`,duracao:m.m4.mediumDuration,gravidade:m.kl.INFORMACAO}),this.loadAssinatura()});this.subscriptions.add(i)},reject:i=>{this.toastService.clearToast()}})}updateAssinatura(e){}showStartButton(e){const{status:s}=e;return s!=p.n.ATIVO&&s!=p.n.CANCELADA}showPauseButton(e){const{status:s}=e;return s!=p.n.PAUSADO&&s!=p.n.CANCELADA&&s!=p.n.PENDENTE}showCancelButton(e){const{status:s}=e;return s!=p.n.CANCELADA}showModal(e,s){var n=this;return(0,G.Z)(function*(){const i=yield n.modal.create({component:e,backdropDismiss:!1,cssClass:"modal-size-80",componentProps:s});return i.onDidDismiss().then(g=>{const{data:D}=g;n.isLoaded=!1,D&&n.loadAssinatura()}),yield i.present()})()}};_.ctorParameters=()=>[{type:et.K},{type:c.IN},{type:Z.D},{type:q.w},{type:u.F0},{type:tt.d},{type:Y.V},{type:Q.YP}],_=(0,d.gn)([(0,l.wA2)({selector:"app-assinaturas-gestao-main",template:'<div class="card main-view">\n  <p-dataView *ngIf="assinaturas && clientes && planos" emptyMessage="Nada encontrado, experimente trocar os filtros"\n    class="data-container" #dv [lazy]="true" [value]="assinaturas.data" [paginator]="true"\n    [rows]="assinaturas.meta.take" [totalRecords]="assinaturas.meta.itemCount" [pageLinks]="assinaturas.meta.pageCount"\n    (onLazyLoad)="paginarAssinatura($event)" filterBy="nome" layout="list">\n    <ng-template pTemplate="header">\n      <div class="flex flex-column md:flex-row md:justify-content-between mb-2">\n        <p-dropdown #dropdown_planos [options]="planos.data" styleClass="mb-2 md:mb-0"\n          (onClear)="clearPlanoFilter($event)" (onChange)="changePlano($event)" [showClear]="true" [filter]="true"\n          placeholder="Selecione um plano" [virtualScroll]="true" [virtualScrollItemSize]="38" [lazy]="true"\n          (onLazyLoad)="paginarPlanos($event)" (onFilter)="onPlanoFilter($event)"\n          (onFocus)="blurPlanos($event, dropdown_planos)" optionValue="id" optionLabel="nome"\n          [(ngModel)]="selectedPlano">\n          <ng-template pTemplate="loader" let-options="options">\n            <div class="flex align-items-center py-2 px-3" style="height: 38px">\n              <p-skeleton [width]="options.even ? \'60%\' : \'50%\'" height="1rem"></p-skeleton>\n            </div>\n          </ng-template>\n        </p-dropdown>\n\n        <p-dropdown #drop_cliente [options]="clientes.data" styleClass="mb-2 md:mb-0" (onClear)="clearFilter($event)"\n          [showClear]="true" [filter]="true" placeholder="Selecione o assinante" [virtualScroll]="true"\n          [virtualScrollItemSize]="38" [lazy]="true" (onChange)="changeCliente($event)"\n          (onLazyLoad)="paginarCliente($event)" (onFilter)="onClienteFilter($event)"\n          (onFocus)="blurCliente($event, drop_cliente)" optionValue="id" optionLabel="nome"\n          [(ngModel)]="selectedCliente" >\n          <ng-template pTemplate="loader" let-options="options">\n            <div class="flex align-items-center py-2 px-3" style="height: 38px">\n              <p-skeleton [width]="options.even ? \'60%\' : \'50%\'" height="1rem"></p-skeleton>\n            </div>\n          </ng-template>\n        </p-dropdown>\n\n        <p-dropdown #dropdown_filtro [options]="sortOptions" placeholder="Status" (onChange)="changeFiltro($event)"\n          (onClear)="clearFilter($event)" [showClear]="true" styleClass="mb-2 md:mb-0"></p-dropdown>\n      </div>\n\n      <div class="flex flex-column md:flex-row md:justify-content-end">\n        <button pButton type="button" class="p-button-outlined p-button-danger sm:ml-2 mt-2" icon="pi pi-times"\n          label="Limpar filtros" (click)="clearAllFilters($event, dropdown_planos, dropdown_filtro)">\n        </button>\n      </div>\n\n      <div class="flex flex-column md:flex-row md:justify-content-end">\n        <p-button class="sm:ml-2 mt-2" icon="pi pi-plus" label="Nova assinatura" (click)="createNewAssinatura()">\n        </p-button>\n      </div>\n\n      <div class="flex justify-content-center">\n        <span class="p-input-icon-right mb-2 md:mb-0 mt-2">\n          <i class="pi pi-search cursor-pointer text-primary" (click)="searchAssinatura()"></i>\n          <input type="search" pInputText [(ngModel)]="searchedAssinatura" [ngModelOptions]="{standalone: true}"\n            placeholder="ID ou c\xf3digo da assinatura" (keyup.enter)="searchAssinatura()">\n        </span>\n      </div>\n    </ng-template>\n\n    <ng-template let-assinatura pTemplate="listItem">\n      <div #templateGrid class="col-12">\n        <div class="data-list-item">\n          <div class="crop mb-2 md:mb-0 ">\n            <img class="border-circle border-2 border-primary" [src]="setUserImage(assinatura.assinante)"\n              [alt]="assinatura.assinante.nome" />\n          </div>\n          <div class="data-list-detail">\n            <div class="data-name">{{ assinatura.id }}</div>\n            <div class="data-description mt-2">Status: {{ assinatura.status }}</div>\n            <div class="data-description mt-2">Plano: {{ assinatura.plano_assinatura?.nome }}</div>\n            <div class="data-description mt-1">Cliente: {{ assinatura.assinante?.nome || "Cliente n\xe3o identificado"\n              }}</div>\n            <div class="data-description mt-2">Modalidade: {{ assinatura.modalidade }}</div>\n            <div class="mt-3">\n              <i class="pi pi-play data-category-icon text-primary"></i>\n              <span class="data-category">In\xedcio:\n                {{assinatura.data_inicio | date: \'dd/MM/yyyy -\n                HH:mm:ss\' : \'-0300\' }}h</span>\n              <br><br>\n              <i class="pi pi-stopwatch data-category-icon text-primary"></i>\n              <span class="data-category">Fim (previs\xe3o):\n                {{assinatura.data_fim | date: \'dd/MM/yyyy -\n                HH:mm:ss\' : \'-0300\' }}h</span>\n            </div>\n          </div>\n          <div class="data-list-action">\n            <button pButton type="button" class="p-button-info" icon="pi pi-file-edit" label="Detalhar assinatura"\n              (click)="openDetailAssinatura(assinatura)">\n            </button>\n            <button *ngIf="showStartButton(assinatura)" pButton type="button" class="mt-2 p-button-success"\n              icon="pi pi-play" label="Iniciar assinatura" (click)="startAssinatura(assinatura)">\n            </button>\n            <button *ngIf="showPauseButton(assinatura)" pButton type="button" class="mt-2 p-button-warning"\n              icon="pi pi-pause" label="Pausar assinatura" (click)="pauseAssinatura(assinatura)">\n            </button>\n            <button *ngIf="showCancelButton(assinatura)" pButton type="button" class="p-button-outlined p-button-danger"\n              icon="pi pi-times" label="Cancelar assinatura" (click)="cancelAssinatura(assinatura)">\n            </button>\n          </div>\n        </div>\n      </div>\n    </ng-template>\n  </p-dataView>\n</div>\n\n<p-confirmDialog acceptLabel="Sim" rejectLabel="N\xe3o" [style]="{width: \'50vw\'}" [baseZIndex]="10000"\n  rejectButtonStyleClass="p-button-text"></p-confirmDialog>',styles:[""]})],_);var nt=t(58949),O=t(85226),it=t(91670);let E=class{};E=(0,d.gn)([(0,l.LVF)({declarations:[_],imports:[a.ez,o.u5,o.UX,c.Pc,b.hJ,S.T,T.j,L.Iu,U.L$,x.S,K.kW,W.x,w.l,j.m,k.$9,F.FI,N._8,V.D,z.Q,R.U,$.O,B.cc,nt.d,O.o,it.A],exports:[_]})],E);let P=class{};P=(0,d.gn)([(0,l.LVF)({imports:[a.ez,o.u5,c.Pc,y,O.o,E],declarations:[v]})],P)},17489:(M,h,t)=>{t.d(h,{m:()=>o});var d=t(98274),l=t(36895);class a{constructor(){this.shape="rectangle",this.animation="wave",this.borderRadius=null,this.size=null,this.width="100%",this.height="1rem"}containerClass(){return{"p-skeleton p-component":!0,"p-skeleton-circle":"circle"===this.shape,"p-skeleton-none":"none"===this.animation}}containerStyle(){return this.size?{...this.style,width:this.size,height:this.size,borderRadius:this.borderRadius}:{...this.style,width:this.width,height:this.height,borderRadius:this.borderRadius}}}a.\u0275fac=function(u){return new(u||a)},a.\u0275cmp=d.Xpm({type:a,selectors:[["p-skeleton"]],hostAttrs:[1,"p-element"],inputs:{styleClass:"styleClass",style:"style",shape:"shape",animation:"animation",borderRadius:"borderRadius",size:"size",width:"width",height:"height"},decls:1,vars:4,consts:[[3,"ngClass","ngStyle"]],template:function(u,r){1&u&&d._UZ(0,"div",0),2&u&&(d.Tol(r.styleClass),d.Q6J("ngClass",r.containerClass())("ngStyle",r.containerStyle()))},dependencies:[l.mk,l.PC],styles:['.p-skeleton{position:relative;overflow:hidden}.p-skeleton:after{content:"";animation:p-skeleton-animation 1.2s infinite;height:100%;left:0;position:absolute;right:0;top:0;transform:translate(-100%);z-index:1}.p-skeleton.p-skeleton-circle{border-radius:50%}.p-skeleton-none:after{animation:none}@keyframes p-skeleton-animation{0%{transform:translate(-100%)}to{transform:translate(100%)}}\n'],encapsulation:2,changeDetection:0});class o{}o.\u0275fac=function(u){return new(u||o)},o.\u0275mod=d.oAB({type:o,declarations:[a],imports:[l.ez],exports:[a]}),o.\u0275inj=d.cJS({imports:[l.ez]})},45132:(M,h,t)=>{t.d(h,{l:()=>c});var d=t(36895),l=t(98274),a=t(19592);class o{constructor(r,f){this.el=r,this.renderer=f}ngAfterViewInit(){this.eventListener=this.renderer.listen(this.el.nativeElement,"click",()=>{this.target=this.resolveTarget(),this.toggleClass?a.p.hasClass(this.target,this.toggleClass)?a.p.removeClass(this.target,this.toggleClass):a.p.addClass(this.target,this.toggleClass):null===this.target.offsetParent?this.enter():this.leave()})}enter(){this.enterActiveClass?this.animating||(this.animating=!0,"slidedown"===this.enterActiveClass&&(this.target.style.height="0px",a.p.removeClass(this.target,"hidden"),this.target.style.maxHeight=this.target.scrollHeight+"px",a.p.addClass(this.target,"hidden"),this.target.style.height=""),a.p.addClass(this.target,this.enterActiveClass),this.enterClass&&a.p.removeClass(this.target,this.enterClass),this.enterListener=this.renderer.listen(this.target,"animationend",()=>{a.p.removeClass(this.target,this.enterActiveClass),this.enterToClass&&a.p.addClass(this.target,this.enterToClass),this.enterListener(),"slidedown"===this.enterActiveClass&&(this.target.style.maxHeight=""),this.animating=!1})):(this.enterClass&&a.p.removeClass(this.target,this.enterClass),this.enterToClass&&a.p.addClass(this.target,this.enterToClass)),this.hideOnOutsideClick&&this.bindDocumentListener()}leave(){this.leaveActiveClass?this.animating||(this.animating=!0,a.p.addClass(this.target,this.leaveActiveClass),this.leaveClass&&a.p.removeClass(this.target,this.leaveClass),this.leaveListener=this.renderer.listen(this.target,"animationend",()=>{a.p.removeClass(this.target,this.leaveActiveClass),this.leaveToClass&&a.p.addClass(this.target,this.leaveToClass),this.leaveListener(),this.animating=!1})):(this.leaveClass&&a.p.removeClass(this.target,this.leaveClass),this.leaveToClass&&a.p.addClass(this.target,this.leaveToClass)),this.hideOnOutsideClick&&this.unbindDocumentListener()}resolveTarget(){if(this.target)return this.target;switch(this.selector){case"@next":return this.el.nativeElement.nextElementSibling;case"@prev":return this.el.nativeElement.previousElementSibling;case"@parent":return this.el.nativeElement.parentElement;case"@grandparent":return this.el.nativeElement.parentElement.parentElement;default:return document.querySelector(this.selector)}}bindDocumentListener(){this.documentListener||(this.documentListener=this.renderer.listen(this.el.nativeElement.ownerDocument,"click",r=>{this.isVisible()&&"static"!==getComputedStyle(this.target).getPropertyValue("position")?this.isOutsideClick(r)&&this.leave():this.unbindDocumentListener()}))}isVisible(){return null!==this.target.offsetParent}isOutsideClick(r){return!this.el.nativeElement.isSameNode(r.target)&&!this.el.nativeElement.contains(r.target)&&!this.target.contains(r.target)}unbindDocumentListener(){this.documentListener&&(this.documentListener(),this.documentListener=null)}ngOnDestroy(){this.target=null,this.eventListener&&this.eventListener(),this.unbindDocumentListener()}}o.\u0275fac=function(r){return new(r||o)(l.Y36(l.SBq),l.Y36(l.Qsj))},o.\u0275dir=l.lG2({type:o,selectors:[["","pStyleClass",""]],hostAttrs:[1,"p-element"],inputs:{selector:["pStyleClass","selector"],enterClass:"enterClass",enterActiveClass:"enterActiveClass",enterToClass:"enterToClass",leaveClass:"leaveClass",leaveActiveClass:"leaveActiveClass",leaveToClass:"leaveToClass",hideOnOutsideClick:"hideOnOutsideClick",toggleClass:"toggleClass"}});class c{}c.\u0275fac=function(r){return new(r||c)},c.\u0275mod=l.oAB({type:c,declarations:[o],imports:[d.ez],exports:[o]}),c.\u0275inj=l.cJS({imports:[d.ez]})}}]);